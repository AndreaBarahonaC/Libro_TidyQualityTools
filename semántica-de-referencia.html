<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 7 Semántica de referencia | R6</title>
  <meta name="description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  <meta name="generator" content="bookdown 0.37 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 7 Semántica de referencia | R6" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 7 Semántica de referencia | R6" />
  
  <meta name="twitter:description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  

<meta name="author" content="Miguel Flores" />
<meta name="author" content="Andrea Barahona" />
<meta name="author" content="Fabián Encarnación" />
<meta name="author" content="Dario Quishpe" />


<meta name="date" content="2024-04-19" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="controles-de-acceso.html"/>
<link rel="next" href="por-qué-r6.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A Minimal Book Example</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Prerequisites</a></li>
<li class="chapter" data-level="2" data-path="programación-orientada-a-objetos-poo.html"><a href="programación-orientada-a-objetos-poo.html"><i class="fa fa-check"></i><b>2</b> Programación orientada a objetos (POO)</a>
<ul>
<li class="chapter" data-level="2.1" data-path="programación-orientada-a-objetos-poo.html"><a href="programación-orientada-a-objetos-poo.html#introducción"><i class="fa fa-check"></i><b>2.1</b> Introducción</a></li>
<li class="chapter" data-level="2.2" data-path="programación-orientada-a-objetos-poo.html"><a href="programación-orientada-a-objetos-poo.html#sistemas-de-programación-orientada-a-objetos"><i class="fa fa-check"></i><b>2.2</b> Sistemas de programación orientada a objetos</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="programación-orientada-a-objetos-poo.html"><a href="programación-orientada-a-objetos-poo.html#paradigmas"><i class="fa fa-check"></i><b>2.2.1</b> Paradigmas</a></li>
<li class="chapter" data-level="2.2.2" data-path="programación-orientada-a-objetos-poo.html"><a href="programación-orientada-a-objetos-poo.html#especificaciones-de-los-principales-sistemas-poo-en-r"><i class="fa fa-check"></i><b>2.2.2</b> Especificaciones de los principales sistemas POO en R</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="tipos-de-bases.html"><a href="tipos-de-bases.html"><i class="fa fa-check"></i><b>3</b> Tipos de bases</a>
<ul>
<li class="chapter" data-level="3.1" data-path="tipos-de-bases.html"><a href="tipos-de-bases.html#objetos-base-vs-objetos-oo"><i class="fa fa-check"></i><b>3.1</b> Objetos Base vs Objetos OO</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="introducción-a-r6.html"><a href="introducción-a-r6.html"><i class="fa fa-check"></i><b>4</b> Introducción a R6</a></li>
<li class="chapter" data-level="5" data-path="clases-y-métodos.html"><a href="clases-y-métodos.html"><i class="fa fa-check"></i><b>5</b> Clases y métodos</a>
<ul>
<li class="chapter" data-level="5.1" data-path="clases-y-métodos.html"><a href="clases-y-métodos.html#encadenamiento-de-métodos"><i class="fa fa-check"></i><b>5.1</b> Encadenamiento de métodos</a></li>
<li class="chapter" data-level="5.2" data-path="clases-y-métodos.html"><a href="clases-y-métodos.html#métodos-importantes"><i class="fa fa-check"></i><b>5.2</b> Métodos importantes</a></li>
<li class="chapter" data-level="5.3" data-path="clases-y-métodos.html"><a href="clases-y-métodos.html#agregar-métodos-después-de-la-creación"><i class="fa fa-check"></i><b>5.3</b> Agregar métodos después de la creación</a></li>
<li class="chapter" data-level="5.4" data-path="clases-y-métodos.html"><a href="clases-y-métodos.html#herencia"><i class="fa fa-check"></i><b>5.4</b> Herencia</a></li>
<li class="chapter" data-level="5.5" data-path="clases-y-métodos.html"><a href="clases-y-métodos.html#introspección"><i class="fa fa-check"></i><b>5.5</b> Introspección</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="controles-de-acceso.html"><a href="controles-de-acceso.html"><i class="fa fa-check"></i><b>6</b> Controles de Acceso</a>
<ul>
<li class="chapter" data-level="6.1" data-path="controles-de-acceso.html"><a href="controles-de-acceso.html#privacidad"><i class="fa fa-check"></i><b>6.1</b> Privacidad</a></li>
<li class="chapter" data-level="6.2" data-path="controles-de-acceso.html"><a href="controles-de-acceso.html#campos-activos"><i class="fa fa-check"></i><b>6.2</b> Campos Activos</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="semántica-de-referencia.html"><a href="semántica-de-referencia.html"><i class="fa fa-check"></i><b>7</b> Semántica de referencia</a>
<ul>
<li class="chapter" data-level="7.1" data-path="semántica-de-referencia.html"><a href="semántica-de-referencia.html#razonamientos"><i class="fa fa-check"></i><b>7.1</b> Razonamientos</a></li>
<li class="chapter" data-level="7.2" data-path="semántica-de-referencia.html"><a href="semántica-de-referencia.html#finalización"><i class="fa fa-check"></i><b>7.2</b> Finalización</a></li>
<li class="chapter" data-level="7.3" data-path="semántica-de-referencia.html"><a href="semántica-de-referencia.html#campos-r6"><i class="fa fa-check"></i><b>7.3</b> Campos R6</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="por-qué-r6.html"><a href="por-qué-r6.html"><i class="fa fa-check"></i><b>8</b> ¿Por qué R6?</a></li>
<li class="chapter" data-level="9" data-path="ejercicios-prácticos.html"><a href="ejercicios-prácticos.html"><i class="fa fa-check"></i><b>9</b> Ejercicios prácticos</a></li>
<li class="chapter" data-level="10" data-path="bibliografía.html"><a href="bibliografía.html"><i class="fa fa-check"></i><b>10</b> Bibliografía</a></li>
<li class="chapter" data-level="11" data-path="literature.html"><a href="literature.html"><i class="fa fa-check"></i><b>11</b> Literature</a></li>
<li class="chapter" data-level="12" data-path="methods.html"><a href="methods.html"><i class="fa fa-check"></i><b>12</b> Methods</a>
<ul>
<li class="chapter" data-level="12.1" data-path="methods.html"><a href="methods.html#math-example"><i class="fa fa-check"></i><b>12.1</b> math example</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="applications.html"><a href="applications.html"><i class="fa fa-check"></i><b>13</b> Applications</a>
<ul>
<li class="chapter" data-level="13.1" data-path="applications.html"><a href="applications.html#example-one"><i class="fa fa-check"></i><b>13.1</b> Example one</a></li>
<li class="chapter" data-level="13.2" data-path="applications.html"><a href="applications.html#example-two"><i class="fa fa-check"></i><b>13.2</b> Example two</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="final-words.html"><a href="final-words.html"><i class="fa fa-check"></i><b>14</b> Final Words</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R6</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="semántica-de-referencia" class="section level1 hasAnchor" number="7">
<h1><span class="header-section-number">Chapter 7</span> Semántica de referencia<a href="semántica-de-referencia.html#semántica-de-referencia" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Una de las grandes diferencias entre R6 y la mayoría de los demás objetos es que tienen una semántica de referencia. La principal consecuencia de la semántica de referencia es que los objetos no se copian cuando se modifican:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="semántica-de-referencia.html#cb32-1" tabindex="-1"></a>y1 <span class="ot">&lt;-</span> SumaAcum<span class="sc">$</span><span class="fu">new</span>() </span>
<span id="cb32-2"><a href="semántica-de-referencia.html#cb32-2" tabindex="-1"></a>y2 <span class="ot">&lt;-</span> y1</span>
<span id="cb32-3"><a href="semántica-de-referencia.html#cb32-3" tabindex="-1"></a></span>
<span id="cb32-4"><a href="semántica-de-referencia.html#cb32-4" tabindex="-1"></a>y1<span class="sc">$</span><span class="fu">sumar</span>(<span class="dv">10</span>)</span>
<span id="cb32-5"><a href="semántica-de-referencia.html#cb32-5" tabindex="-1"></a><span class="fu">c</span>(<span class="at">y1 =</span> y1<span class="sc">$</span>suma, <span class="at">y2 =</span> y2<span class="sc">$</span>suma)</span>
<span id="cb32-6"><a href="semántica-de-referencia.html#cb32-6" tabindex="-1"></a><span class="do">## y1 y2 </span></span>
<span id="cb32-7"><a href="semántica-de-referencia.html#cb32-7" tabindex="-1"></a><span class="do">## 10 10</span></span></code></pre></div>
<p>En cambio, si queremos copiar, necesitamos expecificarlo con el método <code>$clone()</code>:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="semántica-de-referencia.html#cb33-1" tabindex="-1"></a>y1 <span class="ot">&lt;-</span> SumaAcum<span class="sc">$</span><span class="fu">new</span>() </span>
<span id="cb33-2"><a href="semántica-de-referencia.html#cb33-2" tabindex="-1"></a>y2 <span class="ot">&lt;-</span> y1<span class="sc">$</span><span class="fu">clone</span>()</span>
<span id="cb33-3"><a href="semántica-de-referencia.html#cb33-3" tabindex="-1"></a></span>
<span id="cb33-4"><a href="semántica-de-referencia.html#cb33-4" tabindex="-1"></a>y1<span class="sc">$</span><span class="fu">sumar</span>(<span class="dv">10</span>)</span>
<span id="cb33-5"><a href="semántica-de-referencia.html#cb33-5" tabindex="-1"></a><span class="fu">c</span>(<span class="at">y1 =</span> y1<span class="sc">$</span>suma, <span class="at">y2 =</span> y2<span class="sc">$</span>suma)</span>
<span id="cb33-6"><a href="semántica-de-referencia.html#cb33-6" tabindex="-1"></a><span class="do">## y1 y2 </span></span>
<span id="cb33-7"><a href="semántica-de-referencia.html#cb33-7" tabindex="-1"></a><span class="do">## 10  0</span></span></code></pre></div>
<p>(<code>$clone()</code> no clona recursivamente objetos R6 anidados. Si quieres eso, necesitarás usar <code>$clone(deep = TRUE)</code>.)</p>
<p>Hay otras tres consecuencias menos intuitivas:</p>
<ul>
<li><p>Es más difícil razonar sobre el código que utiliza objetos R6 porque es necesario comprender más contexto.</p></li>
<li><p>Tiene sentido pensar en cuándo se elimina un objeto R6 y puede escribir <code>$finalize()</code> para complementar <code>$initialize()</code>.</p></li>
<li><p>Si uno de los campos es un objeto R6, debe crearlo dentro de <code>$initialize()</code>, no de R6Class().</p></li>
</ul>
<p>Estas están descritas con mayor detalle a continuación.</p>
<div id="razonamientos" class="section level2 hasAnchor" number="7.1">
<h2><span class="header-section-number">7.1</span> Razonamientos<a href="semántica-de-referencia.html#razonamientos" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Generalmente, las semanticas de referencias hacen el código más difícil de entender. Tomemos el siguiente ejemplo sencillo:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="semántica-de-referencia.html#cb34-1" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">a =</span> <span class="dv">1</span>)</span>
<span id="cb34-2"><a href="semántica-de-referencia.html#cb34-2" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">b =</span> <span class="dv">2</span>)</span>
<span id="cb34-3"><a href="semántica-de-referencia.html#cb34-3" tabindex="-1"></a></span>
<span id="cb34-4"><a href="semántica-de-referencia.html#cb34-4" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">f</span>(x, y)</span></code></pre></div>
<p>Para la gran mayoría de funciones, sabes que la línea final solo modifica <code>z</code>.</p>
<p>Ahora, tomemos un ejemplo similar que utiliza una clase de referencia de <code>Lista</code> imaginaria:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="semántica-de-referencia.html#cb35-1" tabindex="-1"></a>x <span class="ot">&lt;-</span> Lista<span class="sc">$</span><span class="fu">new</span>(<span class="at">a =</span> <span class="dv">1</span>)</span>
<span id="cb35-2"><a href="semántica-de-referencia.html#cb35-2" tabindex="-1"></a>y <span class="ot">&lt;-</span> Lista<span class="sc">$</span><span class="fu">new</span>(<span class="at">b =</span> <span class="dv">2</span>)</span>
<span id="cb35-3"><a href="semántica-de-referencia.html#cb35-3" tabindex="-1"></a></span>
<span id="cb35-4"><a href="semántica-de-referencia.html#cb35-4" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">f</span>(x, y)</span></code></pre></div>
<p>Es mucho más difícil de entender la línea final: si <code>f()</code> llama a métodos de <code>x</code> o <code>y</code>, podría modificarlos al igual que <code>z</code>. Este es el mayor inconveniente potencial de R6 y se debe tener cuidado de evitarlo escribiendo funciones que devuelvan un valor o modifiquen sus entradas de R6, pero no ambas.</p>
</div>
<div id="finalización" class="section level2 hasAnchor" number="7.2">
<h2><span class="header-section-number">7.2</span> Finalización<a href="semántica-de-referencia.html#finalización" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>La semántica de referencia, permite pensar en el momento en que un objeto R6 es finalizado o eliminado. Esto es diferente a la mayoría de los objetos en R, donde la semántica de copia al modificar significa que puede haber muchas versiones transitorias de un objeto, lo que no permite pensar en cuándo se elimina un objeto de forma lógica.</p>
<p>Por ejemplo, en el caso de objetos de tipo factor en R, cuando se modifican los niveles de un factor, se crea un nuevo objeto factor y el objeto original se deja para que lo recolecte el recolector de basura.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="semántica-de-referencia.html#cb36-1" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>))</span>
<span id="cb36-2"><a href="semántica-de-referencia.html#cb36-2" tabindex="-1"></a><span class="fu">levels</span>(x) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;c&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;a&quot;</span>)</span></code></pre></div>
<p>Debido a que los objetos R6 no se copian al modificarlos, solo se eliminan una vez, tiene sentido pensar en el método <code>$finalize()</code> como un complemento al método <code>$initialize()</code>. Los finalizadores generalmente tienen un papel similar a <code>on.exit()</code>, limpiando cualquier recurso creado por el inicializador.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="semántica-de-referencia.html#cb37-1" tabindex="-1"></a>ArchivoTemporal <span class="ot">&lt;-</span> <span class="fu">R6Class</span>(<span class="st">&quot;ArchivoTemporal&quot;</span>, <span class="fu">list</span>(</span>
<span id="cb37-2"><a href="semántica-de-referencia.html#cb37-2" tabindex="-1"></a>  <span class="at">ruta =</span> <span class="cn">NULL</span>,</span>
<span id="cb37-3"><a href="semántica-de-referencia.html#cb37-3" tabindex="-1"></a>  <span class="at">initialize =</span> <span class="cf">function</span>() {</span>
<span id="cb37-4"><a href="semántica-de-referencia.html#cb37-4" tabindex="-1"></a>    self<span class="sc">$</span>ruta <span class="ot">&lt;-</span> <span class="fu">tempfile</span>()</span>
<span id="cb37-5"><a href="semántica-de-referencia.html#cb37-5" tabindex="-1"></a>  },</span>
<span id="cb37-6"><a href="semántica-de-referencia.html#cb37-6" tabindex="-1"></a>  <span class="at">finalize =</span> <span class="cf">function</span>() {</span>
<span id="cb37-7"><a href="semántica-de-referencia.html#cb37-7" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">&quot;Cleaning up &quot;</span>, self<span class="sc">$</span>ruta)</span>
<span id="cb37-8"><a href="semántica-de-referencia.html#cb37-8" tabindex="-1"></a>    <span class="fu">unlink</span>(self<span class="sc">$</span>ruta)</span>
<span id="cb37-9"><a href="semántica-de-referencia.html#cb37-9" tabindex="-1"></a>  }</span>
<span id="cb37-10"><a href="semántica-de-referencia.html#cb37-10" tabindex="-1"></a>))</span></code></pre></div>
<p>El ejemplo proporcionado muestra una clase llamada <code>ArchivoTemporal</code>, que encapsula un archivo temporal y se encarga de eliminarlo automáticamente cuando se finaliza la instancia de la clase.</p>
<p>El método <code>finalize</code> será ejecutado cuando el objeto sea eliminado (o más precisamente, por la primera recolección de basura después de que el objeto haya sido desligado de todos los nombres) o cuando R se cierre.</p>
<p>Esto significa que el finalizador puede ser llamado efectivamente en cualquier parte de tu código en R, lo que hace casi imposible razonar sobre el código del finalizador que toca estructuras de datos compartidas. Se recomienda evitar estos posibles problemas utilizando el finalizador solo para limpiar recursos privados asignados por el inicializador.</p>
<p>Finalmente, veamos cómo se utiliza esta clase <code>ArchivoTemporal</code> creando una instancia, luego eliminando explícitamente la instancia con <code>rm()</code>, lo que provoca que el finalizador se ejecute para limpiar el archivo temporal.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="semántica-de-referencia.html#cb38-1" tabindex="-1"></a>at <span class="ot">&lt;-</span> ArchivoTemporal<span class="sc">$</span><span class="fu">new</span>()</span>
<span id="cb38-2"><a href="semántica-de-referencia.html#cb38-2" tabindex="-1"></a><span class="fu">rm</span>(at)</span></code></pre></div>
<p>En resumen, los objetos R6 permiten definir métodos <code>initialize</code> y <code>finalize</code>, que se ejecutan al crear y eliminar instancias de la clase respectivamente, permitiendo una gestión más controlada de los recursos y la limpieza de la memoria.</p>
</div>
<div id="campos-r6" class="section level2 hasAnchor" number="7.3">
<h2><span class="header-section-number">7.3</span> Campos R6<a href="semántica-de-referencia.html#campos-r6" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Una última consecuencia que puede surgir al utilizar semántica de referencia en R6, es particularmente cuando se usa una instancia de una clase R6 como valor predeterminado de un campo. La semántica de referencia significa que cuando asignas un objeto a otro, no se crea una copia independiente, sino que ambos hacen referencia al mismo objeto en la memoria.</p>
<p>Por ejemplo, creemos una clase llamada <code>DatabaseTemporal</code> que tiene un campo <code>archivo</code>, que es una instancia de la clase <code>ArchivoTemporal</code>.</p>
<p>Por ejemplo, dado el siguiente código, queremos crear una base de datos temporal cada vez que llamamos a DatabaseTemporal$new(), pero el código actual siempre usa la misma ruta.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="semántica-de-referencia.html#cb39-1" tabindex="-1"></a>DatabaseTemporal <span class="ot">&lt;-</span> <span class="fu">R6Class</span>(<span class="st">&quot;DatabaseTemporal&quot;</span>, <span class="fu">list</span>(</span>
<span id="cb39-2"><a href="semántica-de-referencia.html#cb39-2" tabindex="-1"></a>  <span class="at">con =</span> <span class="cn">NULL</span>,</span>
<span id="cb39-3"><a href="semántica-de-referencia.html#cb39-3" tabindex="-1"></a>  <span class="at">file =</span> ArchivoTemporal<span class="sc">$</span><span class="fu">new</span>(),</span>
<span id="cb39-4"><a href="semántica-de-referencia.html#cb39-4" tabindex="-1"></a>  <span class="at">initialize =</span> <span class="cf">function</span>() {</span>
<span id="cb39-5"><a href="semántica-de-referencia.html#cb39-5" tabindex="-1"></a>    self<span class="sc">$</span>con <span class="ot">&lt;-</span> DBI<span class="sc">::</span><span class="fu">dbConnect</span>(RSQLite<span class="sc">::</span><span class="fu">SQLite</span>(), <span class="at">ruta =</span> file<span class="sc">$</span>ruta)</span>
<span id="cb39-6"><a href="semántica-de-referencia.html#cb39-6" tabindex="-1"></a>  },</span>
<span id="cb39-7"><a href="semántica-de-referencia.html#cb39-7" tabindex="-1"></a>  <span class="at">finalize =</span> <span class="cf">function</span>() {</span>
<span id="cb39-8"><a href="semántica-de-referencia.html#cb39-8" tabindex="-1"></a>    DBI<span class="sc">::</span><span class="fu">dbDisconnect</span>(self<span class="sc">$</span>con)</span>
<span id="cb39-9"><a href="semántica-de-referencia.html#cb39-9" tabindex="-1"></a>  }</span>
<span id="cb39-10"><a href="semántica-de-referencia.html#cb39-10" tabindex="-1"></a>))</span>
<span id="cb39-11"><a href="semántica-de-referencia.html#cb39-11" tabindex="-1"></a></span>
<span id="cb39-12"><a href="semántica-de-referencia.html#cb39-12" tabindex="-1"></a>db_a <span class="ot">&lt;-</span> DatabaseTemporal<span class="sc">$</span><span class="fu">new</span>()</span>
<span id="cb39-13"><a href="semántica-de-referencia.html#cb39-13" tabindex="-1"></a>db_b <span class="ot">&lt;-</span> DatabaseTemporal<span class="sc">$</span><span class="fu">new</span>()</span>
<span id="cb39-14"><a href="semántica-de-referencia.html#cb39-14" tabindex="-1"></a></span>
<span id="cb39-15"><a href="semántica-de-referencia.html#cb39-15" tabindex="-1"></a>db_a<span class="sc">$</span>file<span class="sc">$</span>ruta <span class="sc">==</span> db_b<span class="sc">$</span>file<span class="sc">$</span>ruta</span>
<span id="cb39-16"><a href="semántica-de-referencia.html#cb39-16" tabindex="-1"></a><span class="do">## [1] TRUE</span></span></code></pre></div>
<p>(Si está familiarizado con Python, esto es muy similar al problema del “argumento predeterminado mutable”).</p>
<p>El problema es que, cuando se usa una instancia de clase como valor predeterminado para un campo, esa instancia se comparte entre todas las instancias de la clase. Por lo tanto, cada instancia de <code>DatabaseTemporal</code> está haciendo referencia al mismo objeto <code>ArchivoTemporal</code>, en lugar de tener su propia instancia única.</p>
<p>Para solucionar este problema, se debe crear una nueva instancia de <code>ArchivoTemporal</code> dentro del método <code>initialize()</code>, de modo que cada instancia de <code>DatabaseTemporal</code> tenga su propia instancia única de <code>ArchivoTemporal</code>.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="semántica-de-referencia.html#cb40-1" tabindex="-1"></a>DatabaseTemporal <span class="ot">&lt;-</span> <span class="fu">R6Class</span>(<span class="st">&quot;DatabaseTemporal&quot;</span>, <span class="fu">list</span>(</span>
<span id="cb40-2"><a href="semántica-de-referencia.html#cb40-2" tabindex="-1"></a>  <span class="at">con =</span> <span class="cn">NULL</span>,</span>
<span id="cb40-3"><a href="semántica-de-referencia.html#cb40-3" tabindex="-1"></a>  <span class="at">archivo =</span> <span class="cn">NULL</span>,</span>
<span id="cb40-4"><a href="semántica-de-referencia.html#cb40-4" tabindex="-1"></a>  <span class="at">initialize =</span> <span class="cf">function</span>() {</span>
<span id="cb40-5"><a href="semántica-de-referencia.html#cb40-5" tabindex="-1"></a>    self<span class="sc">$</span>archivo <span class="ot">&lt;-</span> ArchivoTemporal<span class="sc">$</span><span class="fu">new</span>()</span>
<span id="cb40-6"><a href="semántica-de-referencia.html#cb40-6" tabindex="-1"></a>    self<span class="sc">$</span>con <span class="ot">&lt;-</span> DBI<span class="sc">::</span><span class="fu">dbConnect</span>(RSQLite<span class="sc">::</span><span class="fu">SQLite</span>(),</span>
<span id="cb40-7"><a href="semántica-de-referencia.html#cb40-7" tabindex="-1"></a>                               <span class="at">ruta =</span> file<span class="sc">$</span>ruta)</span>
<span id="cb40-8"><a href="semántica-de-referencia.html#cb40-8" tabindex="-1"></a>  },</span>
<span id="cb40-9"><a href="semántica-de-referencia.html#cb40-9" tabindex="-1"></a>  <span class="at">finalize =</span> <span class="cf">function</span>() {</span>
<span id="cb40-10"><a href="semántica-de-referencia.html#cb40-10" tabindex="-1"></a>    DBI<span class="sc">::</span><span class="fu">dbDisconnect</span>(self<span class="sc">$</span>con)</span>
<span id="cb40-11"><a href="semántica-de-referencia.html#cb40-11" tabindex="-1"></a>  }</span>
<span id="cb40-12"><a href="semántica-de-referencia.html#cb40-12" tabindex="-1"></a>))</span>
<span id="cb40-13"><a href="semántica-de-referencia.html#cb40-13" tabindex="-1"></a></span>
<span id="cb40-14"><a href="semántica-de-referencia.html#cb40-14" tabindex="-1"></a>db_a <span class="ot">&lt;-</span> DatabaseTemporal<span class="sc">$</span><span class="fu">new</span>()</span>
<span id="cb40-15"><a href="semántica-de-referencia.html#cb40-15" tabindex="-1"></a>db_b <span class="ot">&lt;-</span> DatabaseTemporal<span class="sc">$</span><span class="fu">new</span>()</span>
<span id="cb40-16"><a href="semántica-de-referencia.html#cb40-16" tabindex="-1"></a></span>
<span id="cb40-17"><a href="semántica-de-referencia.html#cb40-17" tabindex="-1"></a>db_a<span class="sc">$</span>archivo<span class="sc">$</span>ruta <span class="sc">==</span> db_b<span class="sc">$</span>archivo<span class="sc">$</span>ruta</span>
<span id="cb40-18"><a href="semántica-de-referencia.html#cb40-18" tabindex="-1"></a><span class="do">## [1] FALSE</span></span></code></pre></div>
<p>Ahora, cada instancia de <code>DatabaseTemporal</code> tiene su propia instancia única de <code>ArchivoTemporal</code>, y por lo tanto, sus caminos de archivo son diferentes, como se espera. Esto garantiza que cada instancia de <code>DatabaseTemporal</code> tenga sus propios recursos independientes.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="controles-de-acceso.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="por-qué-r6.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/01-R6.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["bookdown-demo.pdf", "bookdown-demo.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>

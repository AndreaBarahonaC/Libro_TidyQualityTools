<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Capítulo 4 TidyQuant | Integración del Paquete QualityTools con Tidyverse</title>
  <meta name="description" content="Capítulo 4 TidyQuant | Integración del Paquete QualityTools con Tidyverse" />
  <meta name="generator" content="bookdown 0.37 and GitBook 2.6.7" />

  <meta property="og:title" content="Capítulo 4 TidyQuant | Integración del Paquete QualityTools con Tidyverse" />
  <meta property="og:type" content="book" />
  
  
  <meta name="github-repo" content="rstudio/Libro_TidyQualityTools" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Capítulo 4 TidyQuant | Integración del Paquete QualityTools con Tidyverse" />
  
  
  

<meta name="author" content="Miguel Flores" />
<meta name="author" content="Andrea Barahona" />
<meta name="author" content="Fabián Encarnación" />
<meta name="author" content="Dario Quishpe" />


<meta name="date" content="2024-04-23" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="r6.html"/>
<link rel="next" href="qualitytools.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



<<<<<<< HEAD
  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">UDC</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Preámbulo</a></li>
<li class="chapter" data-level="2" data-path="poo-programación-orientada-a-objetos.html"><a href="poo-programación-orientada-a-objetos.html"><i class="fa fa-check"></i><b>2</b> (POO) Programación Orientada a Objetos</a>
<ul>
<li class="chapter" data-level="2.1" data-path="poo-programación-orientada-a-objetos.html"><a href="poo-programación-orientada-a-objetos.html#introducción"><i class="fa fa-check"></i><b>2.1</b> Introducción</a></li>
<li class="chapter" data-level="2.2" data-path="poo-programación-orientada-a-objetos.html"><a href="poo-programación-orientada-a-objetos.html#sistemas-de-programación-orientada-a-objetos"><i class="fa fa-check"></i><b>2.2</b> Sistemas de programación orientada a objetos</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="poo-programación-orientada-a-objetos.html"><a href="poo-programación-orientada-a-objetos.html#paradigmas"><i class="fa fa-check"></i><b>2.2.1</b> Paradigmas</a></li>
<li class="chapter" data-level="2.2.2" data-path="poo-programación-orientada-a-objetos.html"><a href="poo-programación-orientada-a-objetos.html#especificaciones-de-los-principales-sistemas-poo-en-r"><i class="fa fa-check"></i><b>2.2.2</b> Especificaciones de los principales sistemas POO en R</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="poo-programación-orientada-a-objetos.html"><a href="poo-programación-orientada-a-objetos.html#tipos-de-bases"><i class="fa fa-check"></i><b>2.3</b> Tipos de bases</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="poo-programación-orientada-a-objetos.html"><a href="poo-programación-orientada-a-objetos.html#objetos-base-vs-objetos-oo"><i class="fa fa-check"></i><b>2.3.1</b> Objetos Base vs Objetos OO</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="r6.html"><a href="r6.html"><i class="fa fa-check"></i><b>3</b> R6</a>
<ul>
<li class="chapter" data-level="3.1" data-path="r6.html"><a href="r6.html#clases-y-métodos"><i class="fa fa-check"></i><b>3.1</b> Clases y métodos</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="r6.html"><a href="r6.html#encadenamiento-de-métodos"><i class="fa fa-check"></i><b>3.1.1</b> Encadenamiento de métodos</a></li>
<li class="chapter" data-level="3.1.2" data-path="r6.html"><a href="r6.html#métodos-importantes"><i class="fa fa-check"></i><b>3.1.2</b> Métodos importantes</a></li>
<li class="chapter" data-level="3.1.3" data-path="r6.html"><a href="r6.html#agregar-métodos-después-de-la-creación"><i class="fa fa-check"></i><b>3.1.3</b> Agregar métodos después de la creación</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="r6.html"><a href="r6.html#controles-de-acceso"><i class="fa fa-check"></i><b>3.2</b> Controles de Acceso</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="r6.html"><a href="r6.html#privacidad"><i class="fa fa-check"></i><b>3.2.1</b> Privacidad</a></li>
<li class="chapter" data-level="3.2.2" data-path="r6.html"><a href="r6.html#campos-activos"><i class="fa fa-check"></i><b>3.2.2</b> Campos Activos</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="r6.html"><a href="r6.html#semántica-de-referencia"><i class="fa fa-check"></i><b>3.3</b> Semántica de referencia</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="r6.html"><a href="r6.html#razonamientos"><i class="fa fa-check"></i><b>3.3.1</b> Razonamientos</a></li>
<li class="chapter" data-level="3.3.2" data-path="r6.html"><a href="r6.html#finalización"><i class="fa fa-check"></i><b>3.3.2</b> Finalización</a></li>
<li class="chapter" data-level="3.3.3" data-path="r6.html"><a href="r6.html#campos-en-r6"><i class="fa fa-check"></i><b>3.3.3</b> Campos en R6</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="r6.html"><a href="r6.html#por-qué-r6"><i class="fa fa-check"></i><b>3.4</b> ¿Por qué R6?</a></li>
<li class="chapter" data-level="3.5" data-path="r6.html"><a href="r6.html#ejercicios-prácticos"><i class="fa fa-check"></i><b>3.5</b> Ejercicios prácticos</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="tidyquant.html"><a href="tidyquant.html"><i class="fa fa-check"></i><b>4</b> TidyQuant</a>
<ul>
<li class="chapter" data-level="4.1" data-path="tidyquant.html"><a href="tidyquant.html#compatibilidad-de-funciones"><i class="fa fa-check"></i><b>4.1</b> Compatibilidad de funciones</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="tidyquant.html"><a href="tidyquant.html#funcionalidad-zoo"><i class="fa fa-check"></i><b>4.1.1</b> Funcionalidad zoo</a></li>
<li class="chapter" data-level="4.1.2" data-path="tidyquant.html"><a href="tidyquant.html#funcionalidad-xts"><i class="fa fa-check"></i><b>4.1.2</b> Funcionalidad xts</a></li>
<li class="chapter" data-level="4.1.3" data-path="tidyquant.html"><a href="tidyquant.html#funcionalidad-quantmod"><i class="fa fa-check"></i><b>4.1.3</b> Funcionalidad quantmod</a></li>
<li class="chapter" data-level="4.1.4" data-path="tidyquant.html"><a href="tidyquant.html#funcionalidad-ttr"><i class="fa fa-check"></i><b>4.1.4</b> Funcionalidad TTR</a></li>
<li class="chapter" data-level="4.1.5" data-path="tidyquant.html"><a href="tidyquant.html#funcionalidad-performanceanalytics"><i class="fa fa-check"></i><b>4.1.5</b> Funcionalidad PerformanceAnalytics</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="tidyquant.html"><a href="tidyquant.html#poder-cuantitativo-en-acción"><i class="fa fa-check"></i><b>4.2</b> Poder Cuantitativo en Acción</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="tidyquant.html"><a href="tidyquant.html#ejemplo-1-utilizar-quantmod-periodreturn-para-convertir-precios-en-rentabilidad"><i class="fa fa-check"></i><b>4.2.1</b> Ejemplo 1: utilizar quantmod periodReturn para convertir precios en rentabilidad</a></li>
<li class="chapter" data-level="4.2.2" data-path="tidyquant.html"><a href="tidyquant.html#ejemplo-2-utilice-xts-to.period-para-cambiar-la-periodicidad-de-diaria-a-mensual"><i class="fa fa-check"></i><b>4.2.2</b> Ejemplo 2: utilice xts to.period para cambiar la periodicidad de diaria a mensual</a></li>
<li class="chapter" data-level="4.2.3" data-path="tidyquant.html"><a href="tidyquant.html#ejemplo-3-utilice-ttr-runcor-para-visualizar-correlaciones-continuas-de-rendimientos"><i class="fa fa-check"></i><b>4.2.3</b> Ejemplo 3: utilice TTR runCor para visualizar correlaciones continuas de rendimientos</a></li>
<li class="chapter" data-level="4.2.4" data-path="tidyquant.html"><a href="tidyquant.html#ejemplo-4-utilizar-ttrmacd-para-visualizar-la-divergencia-y-convergencia-de-la-media-móvil"><i class="fa fa-check"></i><b>4.2.4</b> Ejemplo 4: utilizar TTR::MACD para visualizar la divergencia y convergencia de la media móvil</a></li>
<li class="chapter" data-level="4.2.5" data-path="tidyquant.html"><a href="tidyquant.html#ejemplo-5-utilizar-xtsapply.quarterly-para-obtener-el-precio-máximo-y-mínimo-para-cada-trimestre"><i class="fa fa-check"></i><b>4.2.5</b> Ejemplo 5: utilizar xts::apply.quarterly para obtener el precio máximo y mínimo para cada trimestre</a></li>
<li class="chapter" data-level="4.2.6" data-path="tidyquant.html"><a href="tidyquant.html#ejemplo-6-utilizar-zoorollapply-para-visualizar-una-regresión-continua"><i class="fa fa-check"></i><b>4.2.6</b> Ejemplo 6: utilizar zoo::rollapply para visualizar una regresión continua</a></li>
<li class="chapter" data-level="4.2.7" data-path="tidyquant.html"><a href="tidyquant.html#ejemplo-7-utilizar-return.clean-y-return.excess-para-limpiar-y-calcular-el-exceso-de-rendimiento"><i class="fa fa-check"></i><b>4.2.7</b> Ejemplo 7: utilizar return.clean y return.excess para limpiar y calcular el exceso de rendimiento</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="qualitytools.html"><a href="qualitytools.html"><i class="fa fa-check"></i><b>5</b> QualityTools</a>
<ul>
<li class="chapter" data-level="5.1" data-path="qualitytools.html"><a href="qualitytools.html#fase-1-definir"><i class="fa fa-check"></i><b>5.1</b> Fase 1: Definir</a></li>
<li class="chapter" data-level="5.2" data-path="qualitytools.html"><a href="qualitytools.html#fase-2-medir"><i class="fa fa-check"></i><b>5.2</b> Fase 2: Medir</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="qualitytools.html"><a href="qualitytools.html#capacidad-de-calibre---msa-tipo-i"><i class="fa fa-check"></i><b>5.2.1</b> Capacidad de calibre - MSA Tipo I</a></li>
<li class="chapter" data-level="5.2.2" data-path="qualitytools.html"><a href="qualitytools.html#repetibilidad-y-reproducibidad-del-calibre---msa-tipo-ii"><i class="fa fa-check"></i><b>5.2.2</b> Repetibilidad y reproducibidad del calibre - MSA Tipo II</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="qualitytools.html"><a href="qualitytools.html#fase-3-analizar"><i class="fa fa-check"></i><b>5.3</b> Fase 3: Analizar</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="qualitytools.html"><a href="qualitytools.html#capacidad-del-proceso"><i class="fa fa-check"></i><b>5.3.1</b> Capacidad del Proceso</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="qualitytools.html"><a href="qualitytools.html#fase-4-mejorar"><i class="fa fa-check"></i><b>5.4</b> Fase 4: Mejorar</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="qualitytools.html"><a href="qualitytools.html#diseños-factoriales-2k"><i class="fa fa-check"></i><b>5.4.1</b> Diseños factoriales <span class="math inline">\(2^{k}\)</span></a></li>
<li class="chapter" data-level="5.4.2" data-path="qualitytools.html"><a href="qualitytools.html#diseños-factoriales-fraccionarios-2k-p"><i class="fa fa-check"></i><b>5.4.2</b> Diseños factoriales fraccionarios <span class="math inline">\(2^{k-p}\)</span></a></li>
<li class="chapter" data-level="5.4.3" data-path="qualitytools.html"><a href="qualitytools.html#diseños-replicados-y-puntos-centrales"><i class="fa fa-check"></i><b>5.4.3</b> Diseños replicados y puntos centrales</a></li>
<li class="chapter" data-level="5.4.4" data-path="qualitytools.html"><a href="qualitytools.html#respuestas-múltiples"><i class="fa fa-check"></i><b>5.4.4</b> Respuestas múltiples</a></li>
<li class="chapter" data-level="5.4.5" data-path="qualitytools.html"><a href="qualitytools.html#pasar-a-un-entorno-de-proceso-con-un-mayor-rendimiento-esperado"><i class="fa fa-check"></i><b>5.4.5</b> Pasar a un entorno de proceso con un mayor rendimiento esperado</a></li>
<li class="chapter" data-level="5.4.6" data-path="qualitytools.html"><a href="qualitytools.html#diseños-de-superficies-de-respuesta"><i class="fa fa-check"></i><b>5.4.6</b> Diseños de superficies de respuesta</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="qualitytools.html"><a href="qualitytools.html#deseabilidades"><i class="fa fa-check"></i><b>5.5</b> Deseabilidades</a></li>
<li class="chapter" data-level="5.6" data-path="qualitytools.html"><a href="qualitytools.html#utilización-de-deseabilidades-junto-con-experimentos-diseñados"><i class="fa fa-check"></i><b>5.6</b> Utilización de deseabilidades junto con experimentos diseñados</a></li>
<li class="chapter" data-level="5.7" data-path="qualitytools.html"><a href="qualitytools.html#diseños-taguchi"><i class="fa fa-check"></i><b>5.7</b> Diseños Taguchi</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="cambio-de-funciones.html"><a href="cambio-de-funciones.html"><i class="fa fa-check"></i><b>6</b> Cambio de Funciones</a>
<ul>
<li class="chapter" data-level="6.1" data-path="cambio-de-funciones.html"><a href="cambio-de-funciones.html#fase-1-definir-1"><i class="fa fa-check"></i><b>6.1</b> Fase 1: Definir</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="cambio-de-funciones.html"><a href="cambio-de-funciones.html#función-pareto"><i class="fa fa-check"></i><b>6.1.1</b> 1. Función Pareto</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="cambio-de-funciones.html"><a href="cambio-de-funciones.html#fase-2-medir-1"><i class="fa fa-check"></i><b>6.2</b> Fase 2: Medir</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="cambio-de-funciones.html"><a href="cambio-de-funciones.html#función-cg"><i class="fa fa-check"></i><b>6.2.1</b> 1. Función cg</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="referencias.html"><a href="referencias.html"><i class="fa fa-check"></i>Referencias</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

=======
      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> Preámbulo</a></li>
<li><a class="" href="poo-programaci%C3%B3n-orientada-a-objetos.html"><span class="header-section-number">2</span> (POO) Programación Orientada a Objetos</a></li>
<li><a class="" href="r6.html"><span class="header-section-number">3</span> R6</a></li>
<li><a class="active" href="tidyquant.html"><span class="header-section-number">4</span> TidyQuant</a></li>
<li><a class="" href="qualitytools.html"><span class="header-section-number">5</span> QualityTools</a></li>
<li><a class="" href="cambio-de-funciones.html"><span class="header-section-number">6</span> Cambio de Funciones</a></li>
<li><a class="" href="referencias.html">Referencias</a></li>
>>>>>>> a8b725b107cd3ade9afd4976ed6558cfc0d3c521
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Integración del Paquete QualityTools con Tidyverse</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="tidyquant" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">Capítulo 4</span> TidyQuant<a href="tidyquant.html#tidyquant" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<style type="text/css">
.scroll-100 {
  max-height: 100px;
  overflow-y: auto;
  background-color: inherit;
}
</style>
<p>Existe una amplia gama de funciones de análisis cuantitativo útiles que funcionan con objetos de series temporales. El problema es que muchas de estas maravillosas funciones no funcionan con tipos de datos <code>data.frame</code>, ni con el flujo de trabajo de <code>tidyverse</code>.</p>
<p>Por ello el paquete <strong>Tidyquant</strong> integra las funciones más útiles de los paquetes: <code>xts</code>, <code>zoo</code>, <code>quantmod</code>, <code>TTR</code> y `<code>PerformanceAnalytics</code>, por ello, este texto se centra en demostrar como se integran las funciones más importantes con los paquetes financieros cuantitativos.siguientes:</p>
<ul>
<li><p>Transmutar <code>tq_transmute()</code>: Esta funcion devuelve un nuevo ‘tidy data frame’, que normalmente tiene una periodicidad diferente a la de la entrada.</p></li>
<li><p>Mutate <code>tq_mutate()</code>: Esta funcion agrega columanas al tidy data frame.</p></li>
</ul>
<p>Para ello, lo primero que haremos será cargar los paquetes correspondientes:</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="tidyquant.html#cb48-1" tabindex="-1"></a><span class="co"># Cargar tidyquant, lubridate, xts, quantmod, TTR </span></span>
<span id="cb48-2"><a href="tidyquant.html#cb48-2" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb48-3"><a href="tidyquant.html#cb48-3" tabindex="-1"></a><span class="fu">library</span>(tidyquant)</span></code></pre></div>
<div id="compatibilidad-de-funciones" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> Compatibilidad de funciones<a href="tidyquant.html#compatibilidad-de-funciones" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><code>tq_transmute_fun_options()</code> Devuelve una lista de <strong>funciones de mutación compatibles</strong> con cada paquete, para ello haremos una breve discusión de las opciones respecto a cada paquete.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="tidyquant.html#cb49-1" tabindex="-1"></a><span class="fu">tq_transmute_fun_options</span>() <span class="sc">%&gt;%</span> <span class="fu">str</span>()</span></code></pre></div>
<pre class="scroll-100"><code>## List of 5
##  $ zoo                 : chr [1:14] &quot;rollapply&quot; &quot;rollapplyr&quot; &quot;rollmax&quot; &quot;rollmax.default&quot; ...
##  $ xts                 : chr [1:27] &quot;apply.daily&quot; &quot;apply.monthly&quot; &quot;apply.quarterly&quot; &quot;apply.weekly&quot; ...
##  $ quantmod            : chr [1:25] &quot;allReturns&quot; &quot;annualReturn&quot; &quot;ClCl&quot; &quot;dailyReturn&quot; ...
##  $ TTR                 : chr [1:64] &quot;adjRatios&quot; &quot;ADX&quot; &quot;ALMA&quot; &quot;aroon&quot; ...
##  $ PerformanceAnalytics: chr [1:7] &quot;Return.annualized&quot; &quot;Return.annualized.excess&quot; &quot;Return.clean&quot; &quot;Return.cumulative&quot; ...</code></pre>
<p>Para ello, accederemos a las funciones de los respectivos paquetes que tienen compatibilidad para trabarse con <code>tq_transmute</code> y <code>tq_mutate</code> a partir del comando “$”.</p>
<div id="funcionalidad-zoo" class="section level3 hasAnchor" number="4.1.1">
<h3><span class="header-section-number">4.1.1</span> Funcionalidad zoo<a href="tidyquant.html#funcionalidad-zoo" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="tidyquant.html#cb51-1" tabindex="-1"></a><span class="fu">tq_transmute_fun_options</span>()<span class="sc">$</span>zoo</span></code></pre></div>
<pre class="scroll-100"><code>##  [1] &quot;rollapply&quot;          &quot;rollapplyr&quot;         &quot;rollmax&quot;           
##  [4] &quot;rollmax.default&quot;    &quot;rollmaxr&quot;           &quot;rollmean&quot;          
##  [7] &quot;rollmean.default&quot;   &quot;rollmeanr&quot;          &quot;rollmedian&quot;        
## [10] &quot;rollmedian.default&quot; &quot;rollmedianr&quot;        &quot;rollsum&quot;           
## [13] &quot;rollsum.default&quot;    &quot;rollsumr&quot;</code></pre>
<p>Las funciones del paquete <code>zoo</code> que son compatibles se enumerar arriba. EN términos generales, estas son:</p>
<ul>
<li><p>Funciones <em>Roll Apply</em>:</p>
<ul>
<li>Una función genérica para aplicar una función a los márgenes móviles.</li>
<li>Forma: <code>rollapply(data, width, FUN, ..., by = 1, by.column = TRUE, fill = if (na.pad) NA, na.pad = FALSE, partial = FALSE, align = c("center", "left", "right"), coredata = TRUE)</code></li>
<li>Las opciones incluyen: <code>rollmax</code>, <code>rollmean</code>, <code>rollmedian</code>, <code>rollsum</code>, etc.</li>
</ul></li>
</ul>
</div>
<div id="funcionalidad-xts" class="section level3 hasAnchor" number="4.1.2">
<h3><span class="header-section-number">4.1.2</span> Funcionalidad xts<a href="tidyquant.html#funcionalidad-xts" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="tidyquant.html#cb53-1" tabindex="-1"></a><span class="fu">tq_transmute_fun_options</span>()<span class="sc">$</span>xts</span></code></pre></div>
<pre class="scroll-100"><code>##  [1] &quot;apply.daily&quot;     &quot;apply.monthly&quot;   &quot;apply.quarterly&quot; &quot;apply.weekly&quot;   
##  [5] &quot;apply.yearly&quot;    &quot;diff.xts&quot;        &quot;lag.xts&quot;         &quot;period.apply&quot;   
##  [9] &quot;period.max&quot;      &quot;period.min&quot;      &quot;period.prod&quot;     &quot;period.sum&quot;     
## [13] &quot;periodicity&quot;     &quot;to.daily&quot;        &quot;to.hourly&quot;       &quot;to.minutes&quot;     
## [17] &quot;to.minutes10&quot;    &quot;to.minutes15&quot;    &quot;to.minutes3&quot;     &quot;to.minutes30&quot;   
## [21] &quot;to.minutes5&quot;     &quot;to.monthly&quot;      &quot;to.period&quot;       &quot;to.quarterly&quot;   
## [25] &quot;to.weekly&quot;       &quot;to.yearly&quot;       &quot;to_period&quot;</code></pre>
<p>Las funciones del paquete <code>xts</code> que son compatibles están enumeradas arribas. en términos generales, son:</p>
<ul>
<li>Funciones <em>Period Apply</em>:
<ul>
<li>Aplicar una función a un segmento de tiempo, por ejemplo: <code>max</code>, <code>min</code>, <code>mean</code>, etc.</li>
<li>Forma: <code>apply.daily(x, FUN, ...)</code>.</li>
<li>Las opciones incluyen: <code>apply.daily</code>, <code>weekly</code>, <code>monthly</code>, <code>quarterly</code>, <code>yearly</code>.</li>
</ul></li>
<li>Funciones <em>To-Period Functions</em>:
<ul>
<li>Convierte una serie de tiempo en un serie de tiempo de menor periodicidad, por ejemplo, convierte periodicidad diaria en mensual.</li>
<li>Forma: <code>to.period(x, period = 'months', k = 1, indexAt, name = NULL, OHLC = TRUE, ...)</code>.</li>
<li>Las opciones incluyen: <code>to.minutes</code>, <code>hourly</code>, <code>daily</code>, <code>weekly</code>, <code>monthly</code>, <code>quarterly</code>, <code>yearly</code>.</li>
<li>Es importante aclarar que: la estructura de devolución es diferente para <code>to.period</code>, <code>to.monthly</code>, <code>to.weekly</code>, <code>to.quarterly</code>, etc. <code>to.period</code> retorna la fecha, mientras que <code>to.monthly</code> devuelve un caracter de tipo “MON YYYY”. Es recomendable trabajaer con <code>to.period</code>, si se desea trabar con series temporales a través de <code>lubridate</code>.</li>
</ul></li>
</ul>
</div>
<div id="funcionalidad-quantmod" class="section level3 hasAnchor" number="4.1.3">
<h3><span class="header-section-number">4.1.3</span> Funcionalidad quantmod<a href="tidyquant.html#funcionalidad-quantmod" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="tidyquant.html#cb55-1" tabindex="-1"></a><span class="fu">tq_transmute_fun_options</span>()<span class="sc">$</span>quantmod</span></code></pre></div>
<pre class="scroll-100"><code>##  [1] &quot;allReturns&quot;      &quot;annualReturn&quot;    &quot;ClCl&quot;            &quot;dailyReturn&quot;    
##  [5] &quot;Delt&quot;            &quot;HiCl&quot;            &quot;Lag&quot;             &quot;LoCl&quot;           
##  [9] &quot;LoHi&quot;            &quot;monthlyReturn&quot;   &quot;Next&quot;            &quot;OpCl&quot;           
## [13] &quot;OpHi&quot;            &quot;OpLo&quot;            &quot;OpOp&quot;            &quot;periodReturn&quot;   
## [17] &quot;quarterlyReturn&quot; &quot;seriesAccel&quot;     &quot;seriesDecel&quot;     &quot;seriesDecr&quot;     
## [21] &quot;seriesHi&quot;        &quot;seriesIncr&quot;      &quot;seriesLo&quot;        &quot;weeklyReturn&quot;   
## [25] &quot;yearlyReturn&quot;</code></pre>
<p>Las funciones del paquete <code>quantmod</code> que son compatibles se enumeran arriba. En terminos generales, son :</p>
<ul>
<li>Funciones de cambio porcentual (Delt) y retrasos:
<ul>
<li>Delt: <code>Delt(x1, x2 = NULL, k = 0, type = c("arithmetic", "log"))</code>
<ul>
<li>Variaciones de Delt: ClCl, HiCl, LoCl, LoHi, OpCl, OpHi, OpLo, OpOp</li>
<li>Forma: <code>OpCl(OHLC)</code></li>
</ul></li>
<li>Retrasos: <code>Lag(x, k = 1)</code> / Siguiente: <code>Next(x, k = 1)</code> (También puede usar <code>dplyr::lag and dplyr::lead</code>)</li>
</ul></li>
<li>Funciones de devolución del período:
<ul>
<li>Se obtienen los rendimientos aritméticos o logarítmicos para diversas periodicidades, qué incluyen diaria, semanal, mensual, trimestral y anual.</li>
<li>Forma: <code>periodReturn(x, period = 'monthly', subset = NULL, type = 'arithmetic', leading = TRUE, ...)</code></li>
</ul></li>
<li>Funciones de Series:
<ul>
<li>Devuelve valores que describen la serie, las opciones incluyen describir los aumentos o disminuciones, la aceleración o desaceleración y alto o bajo.</li>
<li>Formas: <code>seriesHi(x)</code>, <code>seriesIncr(x, thresh = 0, diff. = 1L)</code>, <code>seriesAccel(x)</code>.</li>
</ul></li>
</ul>
</div>
<div id="funcionalidad-ttr" class="section level3 hasAnchor" number="4.1.4">
<h3><span class="header-section-number">4.1.4</span> Funcionalidad TTR<a href="tidyquant.html#funcionalidad-ttr" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="tidyquant.html#cb57-1" tabindex="-1"></a><span class="fu">tq_transmute_fun_options</span>()<span class="sc">$</span>TTR</span></code></pre></div>
<pre class="scroll-100"><code>##  [1] &quot;adjRatios&quot;          &quot;ADX&quot;                &quot;ALMA&quot;              
##  [4] &quot;aroon&quot;              &quot;ATR&quot;                &quot;BBands&quot;            
##  [7] &quot;CCI&quot;                &quot;chaikinAD&quot;          &quot;chaikinVolatility&quot; 
## [10] &quot;CLV&quot;                &quot;CMF&quot;                &quot;CMO&quot;               
## [13] &quot;CTI&quot;                &quot;DEMA&quot;               &quot;DonchianChannel&quot;   
## [16] &quot;DPO&quot;                &quot;DVI&quot;                &quot;EMA&quot;               
## [19] &quot;EMV&quot;                &quot;EVWMA&quot;              &quot;GMMA&quot;              
## [22] &quot;growth&quot;             &quot;HMA&quot;                &quot;keltnerChannels&quot;   
## [25] &quot;KST&quot;                &quot;lags&quot;               &quot;MACD&quot;              
## [28] &quot;MFI&quot;                &quot;momentum&quot;           &quot;OBV&quot;               
## [31] &quot;PBands&quot;             &quot;ROC&quot;                &quot;rollSFM&quot;           
## [34] &quot;RSI&quot;                &quot;runCor&quot;             &quot;runCov&quot;            
## [37] &quot;runMAD&quot;             &quot;runMax&quot;             &quot;runMean&quot;           
## [40] &quot;runMedian&quot;          &quot;runMin&quot;             &quot;runPercentRank&quot;    
## [43] &quot;runSD&quot;              &quot;runSum&quot;             &quot;runVar&quot;            
## [46] &quot;SAR&quot;                &quot;SMA&quot;                &quot;SMI&quot;               
## [49] &quot;SNR&quot;                &quot;stoch&quot;              &quot;TDI&quot;               
## [52] &quot;TR&quot;                 &quot;TRIX&quot;               &quot;ultimateOscillator&quot;
## [55] &quot;VHF&quot;                &quot;volatility&quot;         &quot;VWAP&quot;              
## [58] &quot;VWMA&quot;               &quot;wilderSum&quot;          &quot;williamsAD&quot;        
## [61] &quot;WMA&quot;                &quot;WPR&quot;                &quot;ZigZag&quot;            
## [64] &quot;ZLEMA&quot;</code></pre>
<p>Aquí hay una breve descripción de las funciones más populares de <code>TTR</code>:</p>
<ul>
<li>Índice de movimiento direccional de Welles Wilder:
<ul>
<li><code>ADX(HLC, n = 14, maType, ...)</code></li>
</ul></li>
<li>Bandas de Bollinger:
<ul>
<li><code>BBands(HLC, n = 20, maType, sd = 2, ...)</code></li>
</ul></li>
<li>Tasa de cambio/impulso:
<ul>
<li>Tasa de cambio - <code>ROC(x, n = 1, type = c("continuous", "discrete"), na.pad = TRUE)</code>.</li>
<li>Impulso/Momento - <code>momentum(x, n = 1, na.pad = TRUE)</code></li>
</ul></li>
<li>Medias Móviles (maType):
<ul>
<li>Media móvil simple - <code>SMA(x, n = 10, ...)</code></li>
<li>Media móvil exponencial - <code>EMA(x, n = 10, wilder = FALSE, ratio = NULL, ...)</code></li>
<li>Media móvil exponencial doble - <code>DEMA(x, n = 10, v = 1, wilder = FALSE, ratio = NULL)</code></li>
<li>Media móvil Ponderada - <code>WMA(x, n = 10, wts = 1:n, ...)</code></li>
<li>Media móvil elástica ponderada por volumen - <code>EVWMA(price, volume, n = 10, ...)</code></li>
<li>Media móvil exponencial de retardo cero - <code>ZLEMA(x, n = 10, ratio = NULL, ...)</code></li>
<li>Precio promedio móvil ponderado por volumen - <code>VWAP(price, volume, n = 10, ...)</code></li>
<li>Media móvil de longitud variable - <code>VMA(x, w, ratio = 1, ...)</code></li>
<li>Media móvil de Hull - <code>HMA(x, n = 20, ...)</code></li>
<li>Média Movil de Arnaud Legoux - <code>ALMA(x, n = 9, offset = 0.85, sigma = 6, ...)</code></li>
</ul></li>
<li>Oscilador MACD:
<ul>
<li><code>MACD(x, nFast = 12, nSlow = 26, nSig = 9, maType, percent = TRUE, ...)</code></li>
</ul></li>
<li>Índice de Fuerza Relativa:
<ul>
<li><code>RSI(price, n = 14, maType, ...)</code></li>
</ul></li>
<li>runFun:
<ul>
<li><code>runSum(x, n = 10, cumulative = FALSE)</code>: devuelve sumas durante una ventana móvil de n períodos.</li>
<li><code>runMin(x, n = 10, cumulative = FALSE)</code>: devuelve mínimos durante una ventana móvil de n períodos.</li>
<li><code>runMax(x, n = 10, cumulative = FALSE)</code>: devuelve máximos durante una ventana móvil de n períodos.</li>
<li><code>runMean(x, n = 10, cumulative = FALSE)</code>: devuelve medias durante una ventana móvil de n períodos.</li>
<li><code>runMedian(x, n = 10, non.unique = "mean", cumulative = FALSE)</code>: devuelve medianas durante una ventana móvil de n períodos.</li>
<li><code>runCov(x, y, n = 10, use = "all.obs", sample = TRUE, cumulative = FALSE)</code>: devuelve covarianzas sobre una ventana móvil de n períodos.</li>
<li><code>runCor(x, y, n = 10, use = "all.obs", sample = TRUE, cumulative = FALSE)</code>: devuelve correlaciones durante una ventana móvil de n períodos.</li>
<li><code>runVar(x, y = NULL, n = 10, sample = TRUE, cumulative = FALSE)</code>: devuelve variaciones durante una ventana móvil de n períodos.</li>
<li><code>runSD(x, n = 10, sample = TRUE, cumulative = FALSE)</code>: devuelve desviaciones estándar durante una ventana móvil de n períodos.</li>
<li><code>runMAD(x, n = 10, center = NULL, stat = "median", constant = 1.4826, non.unique = "mean", cumulative = FALSE)</code>: devuelve las desviaciones absolutas mediana/media durante una ventana móvil de n períodos.</li>
<li><code>wilderSum(x, n = 10)</code>: devuelve una suma ponderada al estilo de Welles Wilder sobre una ventana móvil de n períodos.</li>
</ul></li>
<li>Ocilador estocástico:
<ul>
<li><code>stoch(HLC, nFastK = 14, nFastD = 3, nSlowD = 3, maType, bounded = TRUE, smooth = 1, ...)</code></li>
</ul></li>
<li>Índice de momento estocástico:
<ul>
<li><code>SMI(HLC, n = 13, nFast = 2, nSlow = 25, nSig = 9, maType, bounded = TRUE, ...)</code></li>
</ul></li>
</ul>
</div>
<div id="funcionalidad-performanceanalytics" class="section level3 hasAnchor" number="4.1.5">
<h3><span class="header-section-number">4.1.5</span> Funcionalidad PerformanceAnalytics<a href="tidyquant.html#funcionalidad-performanceanalytics" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="tidyquant.html#cb59-1" tabindex="-1"></a><span class="fu">tq_transmute_fun_options</span>()<span class="sc">$</span>PerformanceAnalytics</span></code></pre></div>
<pre class="scroll-100"><code>## [1] &quot;Return.annualized&quot;        &quot;Return.annualized.excess&quot;
## [3] &quot;Return.clean&quot;             &quot;Return.cumulative&quot;       
## [5] &quot;Return.excess&quot;            &quot;Return.Geltner&quot;          
## [7] &quot;zerofill&quot;</code></pre>
<p>Todas las funciones de mutación <code>PerformanceAnalytics</code> se ocupan de devoluciones:</p>
<ul>
<li><p><code>Return.annualized</code> y <code>Return.annualized.excess</code>: toma los rendimientos del período y los consolida en rendimiento anualizados.</p></li>
<li><p><code>Return.clean</code>: elimina los valores atípicos de las devoluciones.</p></li>
<li><p><code>Return.excess</code>: elimina la tasa libre de riesgo de los rendimientos para generar rendimientos superiores a la tasa libre de riesgo.</p></li>
<li><p><code>zerofill</code>: Se utiliza para reemplazar valores <code>NA</code> con ceros.</p></li>
</ul>
</div>
</div>
<div id="poder-cuantitativo-en-acción" class="section level2 hasAnchor" number="4.2">
<h2><span class="header-section-number">4.2</span> Poder Cuantitativo en Acción<a href="tidyquant.html#poder-cuantitativo-en-acción" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Revisaremos algunos ejemplos, para ello utilizaremos la base de datos <code>FANG</code>, de datos que consta de los precios de las acciones de FB, AMZN, NFLX y GOOG desde principios de 2013 hasta finales del 2016.</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="tidyquant.html#cb61-1" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;FANG&quot;</span>)</span>
<span id="cb61-2"><a href="tidyquant.html#cb61-2" tabindex="-1"></a>FANG</span></code></pre></div>
<pre class="scroll-100"><code>## # A tibble: 4,032 × 8
##    symbol date        open  high   low close    volume adjusted
##    &lt;chr&gt;  &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
##  1 FB     2013-01-02  27.4  28.2  27.4  28    69846400     28  
##  2 FB     2013-01-03  27.9  28.5  27.6  27.8  63140600     27.8
##  3 FB     2013-01-04  28.0  28.9  27.8  28.8  72715400     28.8
##  4 FB     2013-01-07  28.7  29.8  28.6  29.4  83781800     29.4
##  5 FB     2013-01-08  29.5  29.6  28.9  29.1  45871300     29.1
##  6 FB     2013-01-09  29.7  30.6  29.5  30.6 104787700     30.6
##  7 FB     2013-01-10  30.6  31.5  30.3  31.3  95316400     31.3
##  8 FB     2013-01-11  31.3  32.0  31.1  31.7  89598000     31.7
##  9 FB     2013-01-14  32.1  32.2  30.6  31.0  98892800     31.0
## 10 FB     2013-01-15  30.6  31.7  29.9  30.1 173242600     30.1
## # ℹ 4,022 more rows</code></pre>
<div id="ejemplo-1-utilizar-quantmod-periodreturn-para-convertir-precios-en-rentabilidad" class="section level3 hasAnchor" number="4.2.1">
<h3><span class="header-section-number">4.2.1</span> Ejemplo 1: utilizar quantmod periodReturn para convertir precios en rentabilidad<a href="tidyquant.html#ejemplo-1-utilizar-quantmod-periodreturn-para-convertir-precios-en-rentabilidad" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>La funcioón <code>quantmod::periodReturn()</code> genera retornos por periodicidad, para ello, revisemos algunos casos:</p>
<div id="ejemplo-1a-obtener-y-registrar-las-rentabilidades-anuales" class="section level4 hasAnchor" number="4.2.1.1">
<h4><span class="header-section-number">4.2.1.1</span> Ejemplo 1A: Obtener y registrar las rentabilidades anuales<a href="tidyquant.html#ejemplo-1a-obtener-y-registrar-las-rentabilidades-anuales" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Utilizamos la columna de precios de cierre ajustados (ajustada para divisiones de acciones, lo que puede hacer que parezca que una acción tiene un mal desempeño si se incluye una división).</p>
<p>Establecemos <code>select = adjusted</code>, investigamos la función <code>periodReturn</code> y descubrimos que acepta <code>type = "arithmetic"</code> y <code>period = "yearly"</code>, que devuelve los rendimientos anuales.</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="tidyquant.html#cb63-1" tabindex="-1"></a>FANG_annual_returns <span class="ot">&lt;-</span> FANG <span class="sc">%&gt;%</span></span>
<span id="cb63-2"><a href="tidyquant.html#cb63-2" tabindex="-1"></a>    <span class="fu">group_by</span>(symbol) <span class="sc">%&gt;%</span></span>
<span id="cb63-3"><a href="tidyquant.html#cb63-3" tabindex="-1"></a>    <span class="fu">tq_transmute</span>(<span class="at">select     =</span> adjusted, </span>
<span id="cb63-4"><a href="tidyquant.html#cb63-4" tabindex="-1"></a>                 <span class="at">mutate_fun =</span> periodReturn, </span>
<span id="cb63-5"><a href="tidyquant.html#cb63-5" tabindex="-1"></a>                 <span class="at">period     =</span> <span class="st">&quot;yearly&quot;</span>, </span>
<span id="cb63-6"><a href="tidyquant.html#cb63-6" tabindex="-1"></a>                 <span class="at">type       =</span> <span class="st">&quot;arithmetic&quot;</span>)</span>
<span id="cb63-7"><a href="tidyquant.html#cb63-7" tabindex="-1"></a>FANG_annual_returns</span></code></pre></div>
<pre class="scroll-100"><code>## # A tibble: 16 × 3
## # Groups:   symbol [4]
##    symbol date       yearly.returns
##    &lt;chr&gt;  &lt;date&gt;              &lt;dbl&gt;
##  1 FB     2013-12-31         0.952 
##  2 FB     2014-12-31         0.428 
##  3 FB     2015-12-31         0.341 
##  4 FB     2016-12-30         0.0993
##  5 AMZN   2013-12-31         0.550 
##  6 AMZN   2014-12-31        -0.222 
##  7 AMZN   2015-12-31         1.18  
##  8 AMZN   2016-12-30         0.109 
##  9 NFLX   2013-12-31         3.00  
## 10 NFLX   2014-12-31        -0.0721
## 11 NFLX   2015-12-31         1.34  
## 12 NFLX   2016-12-30         0.0824
## 13 GOOG   2013-12-31         0.550 
## 14 GOOG   2014-12-31        -0.0597
## 15 GOOG   2015-12-31         0.442 
## 16 GOOG   2016-12-30         0.0171</code></pre>
<p>Ahora, grafiquemos los redimientos anuales, a partir del uso rápido del paquete <code>ggplot2</code>:</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="tidyquant.html#cb65-1" tabindex="-1"></a>FANG_annual_returns <span class="sc">%&gt;%</span></span>
<span id="cb65-2"><a href="tidyquant.html#cb65-2" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> yearly.returns, <span class="at">fill =</span> symbol)) <span class="sc">+</span></span>
<span id="cb65-3"><a href="tidyquant.html#cb65-3" tabindex="-1"></a>    <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb65-4"><a href="tidyquant.html#cb65-4" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="fu">palette_light</span>()[[<span class="dv">1</span>]]) <span class="sc">+</span></span>
<span id="cb65-5"><a href="tidyquant.html#cb65-5" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>percent) <span class="sc">+</span></span>
<span id="cb65-6"><a href="tidyquant.html#cb65-6" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;FANG: Annual Returns&quot;</span>,</span>
<span id="cb65-7"><a href="tidyquant.html#cb65-7" tabindex="-1"></a>         <span class="at">subtitle =</span> <span class="st">&quot;Get annual returns quickly with tq_transmute!&quot;</span>,</span>
<span id="cb65-8"><a href="tidyquant.html#cb65-8" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">&quot;Annual Returns&quot;</span>, <span class="at">x =</span> <span class="st">&quot;&quot;</span>) <span class="sc">+</span> </span>
<span id="cb65-9"><a href="tidyquant.html#cb65-9" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span> symbol, <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>) <span class="sc">+</span></span>
<span id="cb65-10"><a href="tidyquant.html#cb65-10" tabindex="-1"></a>    <span class="fu">theme_tq</span>() <span class="sc">+</span> </span>
<span id="cb65-11"><a href="tidyquant.html#cb65-11" tabindex="-1"></a>    <span class="fu">scale_fill_tq</span>()</span></code></pre></div>
<p><img src="Libro_TidyQualityTools_files/figure-html/unnamed-chunk-58-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="ejemplo-1b-obtener-devoluciones-de-registros-diarios" class="section level4 hasAnchor" number="4.2.1.2">
<h4><span class="header-section-number">4.2.1.2</span> Ejemplo 1B: Obtener devoluciones de registros diarios<a href="tidyquant.html#ejemplo-1b-obtener-devoluciones-de-registros-diarios" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Los retornos de registros diarios siguen un enfoque similar. Normalmente se usa una función de transmutación <code>tq_transmute</code> porque la función <code>periodReturn</code> acepta diferentes opciones de periodicidad, y cualquier cosa que no sea diaria hará estallar una mutación.</p>
<p>Sin embargo, en nuestro ejemplo, la periodicidad de los rendimientos es la misma que la periodicidad de los precios de las accciones (ambas diarias), por lo que podemos usar cualquiera de las dos funciones mencionadas anterioremente.</p>
<p>Queremos utilizar la columna de precioes de cierre ajustados, para ello configuramos de manera similar al ejemplo anterior y obtenemos lo siguiente:</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="tidyquant.html#cb66-1" tabindex="-1"></a>FANG_daily_log_returns <span class="ot">&lt;-</span> FANG <span class="sc">%&gt;%</span></span>
<span id="cb66-2"><a href="tidyquant.html#cb66-2" tabindex="-1"></a>    <span class="fu">group_by</span>(symbol) <span class="sc">%&gt;%</span></span>
<span id="cb66-3"><a href="tidyquant.html#cb66-3" tabindex="-1"></a>    <span class="fu">tq_transmute</span>(<span class="at">select     =</span> adjusted, </span>
<span id="cb66-4"><a href="tidyquant.html#cb66-4" tabindex="-1"></a>                 <span class="at">mutate_fun =</span> periodReturn, </span>
<span id="cb66-5"><a href="tidyquant.html#cb66-5" tabindex="-1"></a>                 <span class="at">period     =</span> <span class="st">&quot;daily&quot;</span>, </span>
<span id="cb66-6"><a href="tidyquant.html#cb66-6" tabindex="-1"></a>                 <span class="at">type       =</span> <span class="st">&quot;log&quot;</span>,</span>
<span id="cb66-7"><a href="tidyquant.html#cb66-7" tabindex="-1"></a>                 <span class="at">col_rename =</span> <span class="st">&quot;monthly.returns&quot;</span>)</span></code></pre></div>
<p>Y la gráfica, obtenida a partir del paquete <code>ggplot2</code>, se verá de la siguiente manera:</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="tidyquant.html#cb67-1" tabindex="-1"></a>FANG_daily_log_returns <span class="sc">%&gt;%</span></span>
<span id="cb67-2"><a href="tidyquant.html#cb67-2" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> monthly.returns, <span class="at">fill =</span> symbol)) <span class="sc">+</span></span>
<span id="cb67-3"><a href="tidyquant.html#cb67-3" tabindex="-1"></a>    <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb67-4"><a href="tidyquant.html#cb67-4" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;FANG: Charting the Daily Log Returns&quot;</span>,</span>
<span id="cb67-5"><a href="tidyquant.html#cb67-5" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">&quot;Monthly Returns&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Density&quot;</span>) <span class="sc">+</span></span>
<span id="cb67-6"><a href="tidyquant.html#cb67-6" tabindex="-1"></a>    <span class="fu">theme_tq</span>() <span class="sc">+</span></span>
<span id="cb67-7"><a href="tidyquant.html#cb67-7" tabindex="-1"></a>    <span class="fu">scale_fill_tq</span>() <span class="sc">+</span> </span>
<span id="cb67-8"><a href="tidyquant.html#cb67-8" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span> symbol, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="Libro_TidyQualityTools_files/figure-html/unnamed-chunk-60-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="ejemplo-2-utilice-xts-to.period-para-cambiar-la-periodicidad-de-diaria-a-mensual" class="section level3 hasAnchor" number="4.2.2">
<h3><span class="header-section-number">4.2.2</span> Ejemplo 2: utilice xts to.period para cambiar la periodicidad de diaria a mensual<a href="tidyquant.html#ejemplo-2-utilice-xts-to.period-para-cambiar-la-periodicidad-de-diaria-a-mensual" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>La función <code>xts::to.period</code> se utiliza para convertir la periodicidad de un nivel inferior a un nivel superior (ej: meses a años). Dado que se busca una estructura que tenga una escala de tiempo diferente a la de entrada, se debe hacer una transformación. Utilizamos <code>tq_transmute()</code>, pasamos las columnas “open”, “high”, “low”, “close” y “volume”, y usamos el periodo “months”.</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="tidyquant.html#cb68-1" tabindex="-1"></a>FANG <span class="sc">|&gt;</span>  <span class="fu">group_by</span>(symbol) <span class="sc">|&gt;</span> <span class="fu">tq_transmute</span>(<span class="at">select =</span> open<span class="sc">:</span>volume,</span>
<span id="cb68-2"><a href="tidyquant.html#cb68-2" tabindex="-1"></a>                                <span class="at">mutate_fun =</span> to.period,</span>
<span id="cb68-3"><a href="tidyquant.html#cb68-3" tabindex="-1"></a>                                <span class="at">period =</span> <span class="st">&quot;months&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 192 × 7
## # Groups:   symbol [4]
##    symbol date        open  high   low close    volume
##    &lt;chr&gt;  &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;
##  1 FB     2013-01-31  29.2  31.5  28.7  31.0 190744900
##  2 FB     2013-02-28  26.8  27.3  26.3  27.2  83027800
##  3 FB     2013-03-28  26.1  26.2  25.5  25.6  28585700
##  4 FB     2013-04-30  27.1  27.8  27.0  27.8  36245700
##  5 FB     2013-05-31  24.6  25.0  24.3  24.4  35925000
##  6 FB     2013-06-28  24.7  25.0  24.4  24.9  96778900
##  7 FB     2013-07-31  38.0  38.3  36.3  36.8 154828700
##  8 FB     2013-08-30  42.0  42.3  41.1  41.3  67735100
##  9 FB     2013-09-30  50.1  51.6  49.8  50.2 100095000
## 10 FB     2013-10-31  47.2  52    46.5  50.2 248809000
## # ℹ 182 more rows</code></pre>
<p>Podemos comparar la visualización gráfica agrupando y sin agrupas:</p>
<p><strong>Sin agregración de periodicidad</strong></p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="tidyquant.html#cb70-1" tabindex="-1"></a>FANG_diario <span class="ot">&lt;-</span> FANG <span class="sc">|&gt;</span> <span class="fu">group_by</span>(symbol) </span>
<span id="cb70-2"><a href="tidyquant.html#cb70-2" tabindex="-1"></a>FANG_diario <span class="sc">|&gt;</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>date, <span class="at">y=</span>adjusted, <span class="at">color =</span> symbol))<span class="sc">+</span></span>
<span id="cb70-3"><a href="tidyquant.html#cb70-3" tabindex="-1"></a>               <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb70-4"><a href="tidyquant.html#cb70-4" tabindex="-1"></a>               <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Precio diario de acciones&quot;</span>,</span>
<span id="cb70-5"><a href="tidyquant.html#cb70-5" tabindex="-1"></a>                    <span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Precios ajustados&quot;</span>, <span class="at">color =</span> <span class="st">&quot;&quot;</span>)<span class="sc">+</span></span>
<span id="cb70-6"><a href="tidyquant.html#cb70-6" tabindex="-1"></a>               <span class="fu">facet_wrap</span>(<span class="sc">~</span> symbol, <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>)<span class="sc">+</span></span>
<span id="cb70-7"><a href="tidyquant.html#cb70-7" tabindex="-1"></a>               <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>dollar)<span class="sc">+</span></span>
<span id="cb70-8"><a href="tidyquant.html#cb70-8" tabindex="-1"></a>               <span class="fu">theme_tq</span>()<span class="sc">+</span></span>
<span id="cb70-9"><a href="tidyquant.html#cb70-9" tabindex="-1"></a>               <span class="fu">scale_color_tq</span>()</span></code></pre></div>
<p><img src="Libro_TidyQualityTools_files/figure-html/unnamed-chunk-62-1.png" width="672" /></p>
<p><strong>Con agregación de periodicidad mensual</strong></p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="tidyquant.html#cb71-1" tabindex="-1"></a>FANG_mensual <span class="ot">&lt;-</span> FANG <span class="sc">|&gt;</span>  <span class="fu">group_by</span>(symbol) <span class="sc">|&gt;</span> <span class="fu">tq_transmute</span>(<span class="at">select =</span> adjusted,</span>
<span id="cb71-2"><a href="tidyquant.html#cb71-2" tabindex="-1"></a>                                <span class="at">mutate_fun =</span> to.period,</span>
<span id="cb71-3"><a href="tidyquant.html#cb71-3" tabindex="-1"></a>                                <span class="at">period =</span> <span class="st">&quot;months&quot;</span>)</span>
<span id="cb71-4"><a href="tidyquant.html#cb71-4" tabindex="-1"></a>FANG_mensual <span class="sc">|&gt;</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> adjusted, <span class="at">color =</span> symbol)) <span class="sc">+</span></span>
<span id="cb71-5"><a href="tidyquant.html#cb71-5" tabindex="-1"></a>                <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Monthly Stock Prices&quot;</span>, <span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Adjusted Prices&quot;</span>, <span class="at">color =</span> <span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb71-6"><a href="tidyquant.html#cb71-6" tabindex="-1"></a>                <span class="fu">facet_wrap</span>(<span class="sc">~</span> symbol, <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>) <span class="sc">+</span> <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>dollar) <span class="sc">+</span></span>
<span id="cb71-7"><a href="tidyquant.html#cb71-7" tabindex="-1"></a>                <span class="fu">theme_tq</span>() <span class="sc">+</span> <span class="fu">scale_color_tq</span>()</span></code></pre></div>
<p><img src="Libro_TidyQualityTools_files/figure-html/unnamed-chunk-63-1.png" width="672" />
Con esto se reduce la cantidad de puntos y el gráfico de la serie temporal se suaviza.</p>
</div>
<div id="ejemplo-3-utilice-ttr-runcor-para-visualizar-correlaciones-continuas-de-rendimientos" class="section level3 hasAnchor" number="4.2.3">
<h3><span class="header-section-number">4.2.3</span> Ejemplo 3: utilice TTR runCor para visualizar correlaciones continuas de rendimientos<a href="tidyquant.html#ejemplo-3-utilice-ttr-runcor-para-visualizar-correlaciones-continuas-de-rendimientos" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Las correlaciones de rendimiento son una forma para analizar la medida en que un activo imita un índice de referencia. Utilizaremos los datos de <code>FANG</code> como los datos y la línea de base será el sector tecnológico “XLK”, para ello se recupera los precios utilizando <code>tq_get</code>, y los rendimientos se calculan a partir de los precios ajustados del Ejemplo 1</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="tidyquant.html#cb72-1" tabindex="-1"></a><span class="co">#Rendimientos</span></span>
<span id="cb72-2"><a href="tidyquant.html#cb72-2" tabindex="-1"></a>FANG_rend_mensual <span class="ot">&lt;-</span> FANG <span class="sc">|&gt;</span> <span class="fu">group_by</span>(symbol) <span class="sc">|&gt;</span> </span>
<span id="cb72-3"><a href="tidyquant.html#cb72-3" tabindex="-1"></a>                     <span class="fu">tq_transmute</span>(<span class="at">select =</span> adjusted,</span>
<span id="cb72-4"><a href="tidyquant.html#cb72-4" tabindex="-1"></a>                                  <span class="at">mutate_fun =</span> periodReturn,</span>
<span id="cb72-5"><a href="tidyquant.html#cb72-5" tabindex="-1"></a>                                  <span class="at">period =</span> <span class="st">&quot;monthly&quot;</span>)</span>
<span id="cb72-6"><a href="tidyquant.html#cb72-6" tabindex="-1"></a><span class="co">#Valor base de Rendimientos de referencia</span></span>
<span id="cb72-7"><a href="tidyquant.html#cb72-7" tabindex="-1"></a>base_rend_mensual <span class="ot">&lt;-</span> <span class="st">&quot;XLK&quot;</span> <span class="sc">|&gt;</span> <span class="fu">tq_get</span>(<span class="at">get =</span> <span class="st">&quot;stock.prices&quot;</span>,</span>
<span id="cb72-8"><a href="tidyquant.html#cb72-8" tabindex="-1"></a>                                            <span class="at">from =</span> <span class="st">&quot;2013-01-01&quot;</span>,</span>
<span id="cb72-9"><a href="tidyquant.html#cb72-9" tabindex="-1"></a>                                            <span class="at">to =</span> <span class="st">&quot;2016-12-31&quot;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb72-10"><a href="tidyquant.html#cb72-10" tabindex="-1"></a>                              <span class="fu">tq_transmute</span>(<span class="at">select =</span> adjusted,</span>
<span id="cb72-11"><a href="tidyquant.html#cb72-11" tabindex="-1"></a>                                           <span class="at">mutate_fun =</span> periodReturn,</span>
<span id="cb72-12"><a href="tidyquant.html#cb72-12" tabindex="-1"></a>                                           <span class="at">period =</span> <span class="st">&quot;monthly&quot;</span>)</span>
<span id="cb72-13"><a href="tidyquant.html#cb72-13" tabindex="-1"></a></span>
<span id="cb72-14"><a href="tidyquant.html#cb72-14" tabindex="-1"></a><span class="co">#Unir </span></span>
<span id="cb72-15"><a href="tidyquant.html#cb72-15" tabindex="-1"></a>rends <span class="ot">&lt;-</span> <span class="fu">left_join</span>(FANG_rend_mensual, base_rend_mensual, <span class="at">by=</span><span class="st">&quot;date&quot;</span>)</span>
<span id="cb72-16"><a href="tidyquant.html#cb72-16" tabindex="-1"></a>rends</span></code></pre></div>
<pre><code>## # A tibble: 192 × 4
## # Groups:   symbol [4]
##    symbol date       monthly.returns.x monthly.returns.y
##    &lt;chr&gt;  &lt;date&gt;                 &lt;dbl&gt;             &lt;dbl&gt;
##  1 FB     2013-01-31          0.106             -0.0138 
##  2 FB     2013-02-28         -0.120              0.00782
##  3 FB     2013-03-28         -0.0613             0.0258 
##  4 FB     2013-04-30          0.0856             0.0175 
##  5 FB     2013-05-31         -0.123              0.0279 
##  6 FB     2013-06-28          0.0218            -0.0289 
##  7 FB     2013-07-31          0.479              0.0373 
##  8 FB     2013-08-30          0.122             -0.0104 
##  9 FB     2013-09-30          0.217              0.0253 
## 10 FB     2013-10-31         -0.000398           0.0503 
## # ℹ 182 more rows</code></pre>
<p>La función <code>runCor</code> se puede utilizar para evaluar correlaciones rodantes, además se puede incluir el ancho de la correlación que en este caso utilizaremos seis al estar en una escala mensual. Se utilizará <code>tq_transmute_xy</code> para realizar esto:</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="tidyquant.html#cb74-1" tabindex="-1"></a>FANG_corr <span class="ot">&lt;-</span> rends <span class="sc">|&gt;</span> <span class="fu">tq_transmute_xy</span>(<span class="at">x =</span> monthly.returns.x,</span>
<span id="cb74-2"><a href="tidyquant.html#cb74-2" tabindex="-1"></a>                                   <span class="at">y =</span> monthly.returns.y,</span>
<span id="cb74-3"><a href="tidyquant.html#cb74-3" tabindex="-1"></a>                                   <span class="at">mutate_fun =</span> runCor,</span>
<span id="cb74-4"><a href="tidyquant.html#cb74-4" tabindex="-1"></a>                                   <span class="at">n =</span> <span class="dv">6</span>,</span>
<span id="cb74-5"><a href="tidyquant.html#cb74-5" tabindex="-1"></a>                                   <span class="at">col_rename =</span> <span class="st">&quot;corr_6&quot;</span>)</span>
<span id="cb74-6"><a href="tidyquant.html#cb74-6" tabindex="-1"></a><span class="co">#Grafico</span></span>
<span id="cb74-7"><a href="tidyquant.html#cb74-7" tabindex="-1"></a>FANG_corr <span class="sc">|&gt;</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> corr_6, <span class="at">color =</span> symbol))<span class="sc">+</span></span>
<span id="cb74-8"><a href="tidyquant.html#cb74-8" tabindex="-1"></a>             <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="fu">palette_light</span>()[[<span class="dv">1</span>]])<span class="sc">+</span></span>
<span id="cb74-9"><a href="tidyquant.html#cb74-9" tabindex="-1"></a>             <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb74-10"><a href="tidyquant.html#cb74-10" tabindex="-1"></a>             <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;FANG: Correlación 6 meses a XLK&quot;</span>, <span class="at">x=</span><span class="st">&quot;&quot;</span>, <span class="at">y=</span><span class="st">&quot;Correlation&quot;</span>,<span class="at">color=</span><span class="st">&quot;&quot;</span>)<span class="sc">+</span></span>
<span id="cb74-11"><a href="tidyquant.html#cb74-11" tabindex="-1"></a>             <span class="fu">facet_wrap</span>(<span class="sc">~</span>symbol,<span class="at">ncol=</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb74-12"><a href="tidyquant.html#cb74-12" tabindex="-1"></a>             <span class="fu">theme_tq</span>()<span class="sc">+</span><span class="fu">scale_color_tq</span>()</span></code></pre></div>
<p><img src="Libro_TidyQualityTools_files/figure-html/unnamed-chunk-65-1.png" width="672" /></p>
</div>
<div id="ejemplo-4-utilizar-ttrmacd-para-visualizar-la-divergencia-y-convergencia-de-la-media-móvil" class="section level3 hasAnchor" number="4.2.4">
<h3><span class="header-section-number">4.2.4</span> Ejemplo 4: utilizar TTR::MACD para visualizar la divergencia y convergencia de la media móvil<a href="tidyquant.html#ejemplo-4-utilizar-ttrmacd-para-visualizar-la-divergencia-y-convergencia-de-la-media-móvil" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>La función <code>MACD</code> nos da la convergencia y divergencia de la media móvil, vemos que la salida tiene la misma periodicidad que la entrada y las funciones funcionan con las de OHLC, por lo que se puede utilizar <code>tq_mutate()</code></p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="tidyquant.html#cb75-1" tabindex="-1"></a>FANG_macd <span class="ot">&lt;-</span> FANG <span class="sc">|&gt;</span> <span class="fu">group_by</span>(symbol) <span class="sc">|&gt;</span> </span>
<span id="cb75-2"><a href="tidyquant.html#cb75-2" tabindex="-1"></a>                     <span class="fu">tq_mutate</span>(<span class="at">select =</span> close,</span>
<span id="cb75-3"><a href="tidyquant.html#cb75-3" tabindex="-1"></a>                               <span class="at">mutate_fun =</span> MACD,</span>
<span id="cb75-4"><a href="tidyquant.html#cb75-4" tabindex="-1"></a>                               <span class="at">nFast =</span> <span class="dv">12</span>,</span>
<span id="cb75-5"><a href="tidyquant.html#cb75-5" tabindex="-1"></a>                               <span class="at">nSlow =</span> <span class="dv">26</span>,</span>
<span id="cb75-6"><a href="tidyquant.html#cb75-6" tabindex="-1"></a>                               <span class="at">nSig =</span> <span class="dv">9</span>,</span>
<span id="cb75-7"><a href="tidyquant.html#cb75-7" tabindex="-1"></a>                               <span class="at">maType =</span> SMA) <span class="sc">|&gt;</span> </span>
<span id="cb75-8"><a href="tidyquant.html#cb75-8" tabindex="-1"></a>                     <span class="fu">mutate</span>(<span class="at">diff =</span> macd <span class="sc">-</span> signal) <span class="sc">|&gt;</span> </span>
<span id="cb75-9"><a href="tidyquant.html#cb75-9" tabindex="-1"></a>                     <span class="fu">select</span>(<span class="sc">-</span>(open<span class="sc">:</span>volume))</span>
<span id="cb75-10"><a href="tidyquant.html#cb75-10" tabindex="-1"></a>FANG_macd</span></code></pre></div>
<pre><code>## # A tibble: 4,032 × 6
## # Groups:   symbol [4]
##    symbol date       adjusted  macd signal  diff
##    &lt;chr&gt;  &lt;date&gt;        &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
##  1 FB     2013-01-02     28      NA     NA    NA
##  2 FB     2013-01-03     27.8    NA     NA    NA
##  3 FB     2013-01-04     28.8    NA     NA    NA
##  4 FB     2013-01-07     29.4    NA     NA    NA
##  5 FB     2013-01-08     29.1    NA     NA    NA
##  6 FB     2013-01-09     30.6    NA     NA    NA
##  7 FB     2013-01-10     31.3    NA     NA    NA
##  8 FB     2013-01-11     31.7    NA     NA    NA
##  9 FB     2013-01-14     31.0    NA     NA    NA
## 10 FB     2013-01-15     30.1    NA     NA    NA
## # ℹ 4,022 more rows</code></pre>
<p>Y se puede graficar los datos de la siguiente forma:</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="tidyquant.html#cb77-1" tabindex="-1"></a>FANG_macd <span class="sc">%&gt;%</span></span>
<span id="cb77-2"><a href="tidyquant.html#cb77-2" tabindex="-1"></a>    <span class="fu">filter</span>(date <span class="sc">&gt;=</span> <span class="fu">as_date</span>(<span class="st">&quot;2016-10-01&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb77-3"><a href="tidyquant.html#cb77-3" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> date)) <span class="sc">+</span> </span>
<span id="cb77-4"><a href="tidyquant.html#cb77-4" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="fu">palette_light</span>()[[<span class="dv">1</span>]]) <span class="sc">+</span></span>
<span id="cb77-5"><a href="tidyquant.html#cb77-5" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> macd, <span class="at">col =</span> symbol)) <span class="sc">+</span></span>
<span id="cb77-6"><a href="tidyquant.html#cb77-6" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> signal), <span class="at">color =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb77-7"><a href="tidyquant.html#cb77-7" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">y =</span> diff), <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">color =</span> <span class="fu">palette_light</span>()[[<span class="dv">1</span>]]) <span class="sc">+</span></span>
<span id="cb77-8"><a href="tidyquant.html#cb77-8" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span> symbol, <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">scale =</span> <span class="st">&quot;free_y&quot;</span>) <span class="sc">+</span></span>
<span id="cb77-9"><a href="tidyquant.html#cb77-9" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;FANG: Convergencia y Divergencia de la Media Móvil&quot;</span>,</span>
<span id="cb77-10"><a href="tidyquant.html#cb77-10" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">&quot;MACD&quot;</span>, <span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">color =</span> <span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb77-11"><a href="tidyquant.html#cb77-11" tabindex="-1"></a>    <span class="fu">theme_tq</span>() <span class="sc">+</span></span>
<span id="cb77-12"><a href="tidyquant.html#cb77-12" tabindex="-1"></a>    <span class="fu">scale_color_tq</span>()</span></code></pre></div>
<p><img src="Libro_TidyQualityTools_files/figure-html/unnamed-chunk-67-1.png" width="672" /></p>
</div>
<div id="ejemplo-5-utilizar-xtsapply.quarterly-para-obtener-el-precio-máximo-y-mínimo-para-cada-trimestre" class="section level3 hasAnchor" number="4.2.5">
<h3><span class="header-section-number">4.2.5</span> Ejemplo 5: utilizar xts::apply.quarterly para obtener el precio máximo y mínimo para cada trimestre<a href="tidyquant.html#ejemplo-5-utilizar-xtsapply.quarterly-para-obtener-el-precio-máximo-y-mínimo-para-cada-trimestre" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>La función <code>xts::apply.quarterly()</code> se puede utilizar para aplicar funciones por segmentos de tiempos trimestrales. Debido a que se va a usar una escala diferente a la de entrada (diaria) se necesita la función de transmutación <code>tq_transmute</code>, en la cual se configura en el argumento <code>FUN= max</code> para obtener los precios máximos de cierre durante el trimestre y en el argumento <code>mutate_fun</code> se escribe la función a aplicar por segmentos.</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="tidyquant.html#cb78-1" tabindex="-1"></a>FANG_maxtrim <span class="ot">&lt;-</span> FANG <span class="sc">|&gt;</span> <span class="fu">group_by</span>(symbol) <span class="sc">|&gt;</span> </span>
<span id="cb78-2"><a href="tidyquant.html#cb78-2" tabindex="-1"></a>                        <span class="fu">tq_transmute</span>(<span class="at">select =</span> adjusted,</span>
<span id="cb78-3"><a href="tidyquant.html#cb78-3" tabindex="-1"></a>                                     <span class="at">mutate_fun =</span> apply.quarterly,</span>
<span id="cb78-4"><a href="tidyquant.html#cb78-4" tabindex="-1"></a>                                     <span class="at">FUN =</span> max,</span>
<span id="cb78-5"><a href="tidyquant.html#cb78-5" tabindex="-1"></a>                                     <span class="at">col_rename =</span> <span class="st">&quot;max.close&quot;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb78-6"><a href="tidyquant.html#cb78-6" tabindex="-1"></a>                        <span class="fu">mutate</span>(<span class="at">year.qtr =</span> <span class="fu">paste0</span>(<span class="fu">year</span>(date), <span class="st">&quot;-Q&quot;</span>, <span class="fu">quarter</span>(date))) <span class="sc">|&gt;</span> </span>
<span id="cb78-7"><a href="tidyquant.html#cb78-7" tabindex="-1"></a>                        <span class="fu">select</span>(<span class="sc">-</span>date)</span>
<span id="cb78-8"><a href="tidyquant.html#cb78-8" tabindex="-1"></a>FANG_maxtrim</span></code></pre></div>
<pre><code>## # A tibble: 64 × 3
## # Groups:   symbol [4]
##    symbol max.close year.qtr
##    &lt;chr&gt;      &lt;dbl&gt; &lt;chr&gt;   
##  1 FB          32.5 2013-Q1 
##  2 FB          29.0 2013-Q2 
##  3 FB          51.2 2013-Q3 
##  4 FB          58.0 2013-Q4 
##  5 FB          72.0 2014-Q1 
##  6 FB          67.6 2014-Q2 
##  7 FB          79.0 2014-Q3 
##  8 FB          81.4 2014-Q4 
##  9 FB          85.3 2015-Q1 
## 10 FB          88.9 2015-Q2 
## # ℹ 54 more rows</code></pre>
<p>y para obtener los precios mínimos se cambia el argumento <code>FUN = min</code>, además se pueden unir para obtenerlos en una misma salida:</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="tidyquant.html#cb80-1" tabindex="-1"></a>FANG_mintrim <span class="ot">&lt;-</span> FANG <span class="sc">|&gt;</span> <span class="fu">group_by</span>(symbol) <span class="sc">|&gt;</span> </span>
<span id="cb80-2"><a href="tidyquant.html#cb80-2" tabindex="-1"></a>                        <span class="fu">tq_transmute</span>(<span class="at">select =</span> adjusted,</span>
<span id="cb80-3"><a href="tidyquant.html#cb80-3" tabindex="-1"></a>                                     <span class="at">mutate_fun =</span> apply.quarterly,</span>
<span id="cb80-4"><a href="tidyquant.html#cb80-4" tabindex="-1"></a>                                     <span class="at">FUN =</span> min,</span>
<span id="cb80-5"><a href="tidyquant.html#cb80-5" tabindex="-1"></a>                                     <span class="at">col_rename =</span> <span class="st">&quot;min.close&quot;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb80-6"><a href="tidyquant.html#cb80-6" tabindex="-1"></a>                        <span class="fu">mutate</span>(<span class="at">year.qtr =</span> <span class="fu">paste0</span>(<span class="fu">year</span>(date), <span class="st">&quot;-Q&quot;</span>, <span class="fu">quarter</span>(date))) <span class="sc">|&gt;</span> </span>
<span id="cb80-7"><a href="tidyquant.html#cb80-7" tabindex="-1"></a>                        <span class="fu">select</span>(<span class="sc">-</span>date)</span>
<span id="cb80-8"><a href="tidyquant.html#cb80-8" tabindex="-1"></a>FANG_trim <span class="ot">&lt;-</span> <span class="fu">left_join</span>(FANG_maxtrim,FANG_mintrim, <span class="at">by=</span><span class="fu">c</span>(<span class="st">&quot;symbol&quot;</span><span class="ot">=</span><span class="st">&quot;symbol&quot;</span>,<span class="st">&quot;year.qtr&quot;</span><span class="ot">=</span><span class="st">&quot;year.qtr&quot;</span>))</span>
<span id="cb80-9"><a href="tidyquant.html#cb80-9" tabindex="-1"></a>FANG_trim</span></code></pre></div>
<pre><code>## # A tibble: 64 × 4
## # Groups:   symbol [4]
##    symbol max.close year.qtr min.close
##    &lt;chr&gt;      &lt;dbl&gt; &lt;chr&gt;        &lt;dbl&gt;
##  1 FB          32.5 2013-Q1       25.1
##  2 FB          29.0 2013-Q2       22.9
##  3 FB          51.2 2013-Q3       24.4
##  4 FB          58.0 2013-Q4       44.8
##  5 FB          72.0 2014-Q1       53.5
##  6 FB          67.6 2014-Q2       56.1
##  7 FB          79.0 2014-Q3       62.8
##  8 FB          81.4 2014-Q4       72.6
##  9 FB          85.3 2015-Q1       74.1
## 10 FB          88.9 2015-Q2       77.5
## # ℹ 54 more rows</code></pre>
<p>Para la visualización de los datos podemos realizar lo siguiente:</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="tidyquant.html#cb82-1" tabindex="-1"></a>FANG_trim <span class="sc">|&gt;</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>year.qtr,<span class="at">color=</span>symbol))<span class="sc">+</span></span>
<span id="cb82-2"><a href="tidyquant.html#cb82-2" tabindex="-1"></a>             <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">xend=</span>year.qtr,<span class="at">y=</span>min.close,<span class="at">yend=</span>max.close),<span class="at">linewidth=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb82-3"><a href="tidyquant.html#cb82-3" tabindex="-1"></a>             <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> max.close), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb82-4"><a href="tidyquant.html#cb82-4" tabindex="-1"></a>             <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> min.close), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb82-5"><a href="tidyquant.html#cb82-5" tabindex="-1"></a>             <span class="fu">facet_wrap</span>(<span class="sc">~</span> symbol, <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">scale =</span> <span class="st">&quot;free_y&quot;</span>) <span class="sc">+</span></span>
<span id="cb82-6"><a href="tidyquant.html#cb82-6" tabindex="-1"></a>             <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;FANG: Precio máximo y mínimo por trimestre&quot;</span>,</span>
<span id="cb82-7"><a href="tidyquant.html#cb82-7" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">&quot;Precio de acción&quot;</span>, <span class="at">color =</span> <span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb82-8"><a href="tidyquant.html#cb82-8" tabindex="-1"></a>             <span class="fu">theme_tq</span>() <span class="sc">+</span></span>
<span id="cb82-9"><a href="tidyquant.html#cb82-9" tabindex="-1"></a>             <span class="fu">scale_color_tq</span>() <span class="sc">+</span></span>
<span id="cb82-10"><a href="tidyquant.html#cb82-10" tabindex="-1"></a>             <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>dollar) <span class="sc">+</span></span>
<span id="cb82-11"><a href="tidyquant.html#cb82-11" tabindex="-1"></a>             <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb82-12"><a href="tidyquant.html#cb82-12" tabindex="-1"></a>             <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="Libro_TidyQualityTools_files/figure-html/unnamed-chunk-70-1.png" width="672" /></p>
</div>
<div id="ejemplo-6-utilizar-zoorollapply-para-visualizar-una-regresión-continua" class="section level3 hasAnchor" number="4.2.6">
<h3><span class="header-section-number">4.2.6</span> Ejemplo 6: utilizar zoo::rollapply para visualizar una regresión continua<a href="tidyquant.html#ejemplo-6-utilizar-zoorollapply-para-visualizar-una-regresión-continua" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>En este ejemplo se analizará la relación entre dos activos similares: Mastercard y Visa, para mostrar la relación mediante regresión. Primero se verá la tendencia de los rendimientos, para ello utilizamos <code>tq_get()</code> para obtener los precios de las acciones, y <code>tq_transmute()</code> para transformar los precios en rendimientos.</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="tidyquant.html#cb83-1" tabindex="-1"></a>precios_accion <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;MA&quot;</span>, <span class="st">&quot;V&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb83-2"><a href="tidyquant.html#cb83-2" tabindex="-1"></a>    <span class="fu">tq_get</span>(<span class="at">get  =</span> <span class="st">&quot;stock.prices&quot;</span>,</span>
<span id="cb83-3"><a href="tidyquant.html#cb83-3" tabindex="-1"></a>           <span class="at">from =</span> <span class="st">&quot;2015-01-01&quot;</span>,</span>
<span id="cb83-4"><a href="tidyquant.html#cb83-4" tabindex="-1"></a>           <span class="at">to   =</span> <span class="st">&quot;2016-12-31&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb83-5"><a href="tidyquant.html#cb83-5" tabindex="-1"></a>    <span class="fu">group_by</span>(symbol) </span>
<span id="cb83-6"><a href="tidyquant.html#cb83-6" tabindex="-1"></a></span>
<span id="cb83-7"><a href="tidyquant.html#cb83-7" tabindex="-1"></a>rend_accion <span class="ot">&lt;-</span> precios_accion <span class="sc">%&gt;%</span></span>
<span id="cb83-8"><a href="tidyquant.html#cb83-8" tabindex="-1"></a>    <span class="fu">tq_transmute</span>(<span class="at">select     =</span> adjusted,</span>
<span id="cb83-9"><a href="tidyquant.html#cb83-9" tabindex="-1"></a>                 <span class="at">mutate_fun =</span> periodReturn,</span>
<span id="cb83-10"><a href="tidyquant.html#cb83-10" tabindex="-1"></a>                 <span class="at">period     =</span> <span class="st">&quot;daily&quot;</span>,</span>
<span id="cb83-11"><a href="tidyquant.html#cb83-11" tabindex="-1"></a>                 <span class="at">type       =</span> <span class="st">&quot;log&quot;</span>,</span>
<span id="cb83-12"><a href="tidyquant.html#cb83-12" tabindex="-1"></a>                 <span class="at">col_rename =</span> <span class="st">&quot;returns&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb83-13"><a href="tidyquant.html#cb83-13" tabindex="-1"></a>    <span class="fu">spread</span>(<span class="at">key =</span> symbol, <span class="at">value =</span> returns)</span>
<span id="cb83-14"><a href="tidyquant.html#cb83-14" tabindex="-1"></a></span>
<span id="cb83-15"><a href="tidyquant.html#cb83-15" tabindex="-1"></a><span class="co">#GRAFICOS</span></span>
<span id="cb83-16"><a href="tidyquant.html#cb83-16" tabindex="-1"></a>rend_accion <span class="sc">%&gt;%</span></span>
<span id="cb83-17"><a href="tidyquant.html#cb83-17" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>V,<span class="at">y=</span>MA)) <span class="sc">+</span></span>
<span id="cb83-18"><a href="tidyquant.html#cb83-18" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="fu">palette_light</span>()[[<span class="dv">1</span>]], <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb83-19"><a href="tidyquant.html#cb83-19" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>) <span class="sc">+</span></span>
<span id="cb83-20"><a href="tidyquant.html#cb83-20" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Relación de rendimiento de las acciones &quot;</span>) <span class="sc">+</span></span>
<span id="cb83-21"><a href="tidyquant.html#cb83-21" tabindex="-1"></a>    <span class="fu">theme_tq</span>()</span></code></pre></div>
<p><img src="Libro_TidyQualityTools_files/figure-html/unnamed-chunk-71-1.png" width="672" /></p>
<p>Se puede ver estadísticas de la relación a partir de la función <code>lm</code>:</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="tidyquant.html#cb84-1" tabindex="-1"></a><span class="fu">lm</span>(MA<span class="sc">~</span>V,<span class="at">data =</span> rend_accion) <span class="sc">|&gt;</span> <span class="fu">summary</span>()</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = MA ~ V, data = rend_accion)
## 
## Residuals:
##        Min         1Q     Median         3Q        Max 
## -0.0269572 -0.0039659  0.0002151  0.0039651  0.0289462 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 0.0001130  0.0003097   0.365    0.715    
<<<<<<< HEAD
## V           0.8133672  0.0226393  35.927   &lt;2e-16 ***
=======
## V           0.8133654  0.0226393  35.927   &lt;2e-16 ***
>>>>>>> a8b725b107cd3ade9afd4976ed6558cfc0d3c521
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.00695 on 502 degrees of freedom
## Multiple R-squared:   0.72,  Adjusted R-squared:  0.7194 
## F-statistic:  1291 on 1 and 502 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>La estimación del coeficiente es 0.8134 por lo que se tiene una relación positiva, es decir que a medida que V crece, MA aumenta.</p>
<p>Se puede utilizar la funcion <code>rollapply</code> para realizar una regresión móvil, es decir, mostrar como el modelo varía a lo largo del tiempo. Para ello se creará una función:</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="tidyquant.html#cb86-1" tabindex="-1"></a>regr_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(data){</span>
<span id="cb86-2"><a href="tidyquant.html#cb86-2" tabindex="-1"></a>  <span class="fu">coef</span>(<span class="fu">lm</span>(MA<span class="sc">~</span>V,<span class="at">data=</span>timetk<span class="sc">::</span><span class="fu">tk_tbl</span>(data,<span class="at">silent=</span><span class="cn">TRUE</span>)))</span>
<span id="cb86-3"><a href="tidyquant.html#cb86-3" tabindex="-1"></a>}</span></code></pre></div>
<p>y se utilizará <code>tq_mutate()</code> para aplicar la función de regresión creada utilizando <code>rollapply</code> de la siguiente forma:</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="tidyquant.html#cb87-1" tabindex="-1"></a>rend_accion <span class="ot">&lt;-</span> rend_accion <span class="sc">|&gt;</span> <span class="fu">tq_mutate</span>(<span class="at">mutate_fun =</span> rollapply,</span>
<span id="cb87-2"><a href="tidyquant.html#cb87-2" tabindex="-1"></a>                                              <span class="at">width=</span><span class="dv">90</span>,</span>
<span id="cb87-3"><a href="tidyquant.html#cb87-3" tabindex="-1"></a>                                              <span class="at">FUN=</span>regr_fun,</span>
<span id="cb87-4"><a href="tidyquant.html#cb87-4" tabindex="-1"></a>                                              <span class="at">by.column=</span><span class="cn">FALSE</span>,</span>
<span id="cb87-5"><a href="tidyquant.html#cb87-5" tabindex="-1"></a>                                              <span class="at">col_rename =</span> <span class="fu">c</span>(<span class="st">&quot;coef.0&quot;</span>,<span class="st">&quot;coef.1&quot;</span>))</span>
<span id="cb87-6"><a href="tidyquant.html#cb87-6" tabindex="-1"></a>rend_accion</span></code></pre></div>
<pre><code>## # A tibble: 504 × 5
##    date             MA        V coef.0 coef.1
##    &lt;date&gt;        &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
##  1 2015-01-02  0        0           NA     NA
##  2 2015-01-05 -0.0285  -0.0223      NA     NA
##  3 2015-01-06 -0.00216 -0.00646     NA     NA
##  4 2015-01-07  0.0154   0.0133      NA     NA
##  5 2015-01-08  0.0154   0.0133      NA     NA
##  6 2015-01-09 -0.0128  -0.0149      NA     NA
##  7 2015-01-12 -0.0129  -0.00196     NA     NA
##  8 2015-01-13  0.00228  0.00292     NA     NA
##  9 2015-01-14 -0.00108 -0.0202      NA     NA
## 10 2015-01-15 -0.0146  -0.00955     NA     NA
## # ℹ 494 more rows</code></pre>
<p>Para visualizar el primer coeficiente, se puede agregar una linea horizontal utilizando el modelo de conjunto de datos completo, ya que así se puede ver en que momentos se desvía de la tendencia a largo plazo.</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="tidyquant.html#cb89-1" tabindex="-1"></a>rend_accion <span class="sc">|&gt;</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>date,<span class="at">y=</span>coef<span class="fl">.1</span>))<span class="sc">+</span></span>
<span id="cb89-2"><a href="tidyquant.html#cb89-2" tabindex="-1"></a>                  <span class="fu">geom_line</span>(<span class="at">size=</span><span class="dv">1</span>,<span class="at">color=</span><span class="fu">palette_light</span>()[[<span class="dv">1</span>]])<span class="sc">+</span></span>
<span id="cb89-3"><a href="tidyquant.html#cb89-3" tabindex="-1"></a>                  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">0.8134</span>, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="fu">palette_light</span>()[[<span class="dv">2</span>]])<span class="sc">+</span></span>
<span id="cb89-4"><a href="tidyquant.html#cb89-4" tabindex="-1"></a>                  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;MA ~ V: Visualizing Rolling Regression Coefficient&quot;</span>, <span class="at">x =</span> <span class="st">&quot;&quot;</span>)<span class="sc">+</span></span>
<span id="cb89-5"><a href="tidyquant.html#cb89-5" tabindex="-1"></a>                  <span class="fu">theme_tq</span>()</span></code></pre></div>
<p><img src="Libro_TidyQualityTools_files/figure-html/unnamed-chunk-75-1.png" width="672" /></p>
<p>Para visualizar la rentabilidad de las acciones durante el período de tiempo:</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="tidyquant.html#cb90-1" tabindex="-1"></a>precios_accion <span class="sc">|&gt;</span> <span class="fu">tq_transmute</span>(adjusted,</span>
<span id="cb90-2"><a href="tidyquant.html#cb90-2" tabindex="-1"></a>                               periodReturn,</span>
<span id="cb90-3"><a href="tidyquant.html#cb90-3" tabindex="-1"></a>                               <span class="at">period=</span><span class="st">&quot;daily&quot;</span>,</span>
<span id="cb90-4"><a href="tidyquant.html#cb90-4" tabindex="-1"></a>                               <span class="at">type=</span><span class="st">&quot;log&quot;</span>,</span>
<span id="cb90-5"><a href="tidyquant.html#cb90-5" tabindex="-1"></a>                               <span class="at">col_name=</span><span class="st">&quot;returns&quot;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb90-6"><a href="tidyquant.html#cb90-6" tabindex="-1"></a>                   <span class="fu">mutate</span>(<span class="at">wealth.index =</span> <span class="dv">100</span> <span class="sc">*</span> <span class="fu">cumprod</span>(<span class="dv">1</span> <span class="sc">+</span> daily.returns)) <span class="sc">%&gt;%</span></span>
<span id="cb90-7"><a href="tidyquant.html#cb90-7" tabindex="-1"></a>                   <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> wealth.index, <span class="at">color =</span> symbol)) <span class="sc">+</span></span>
<span id="cb90-8"><a href="tidyquant.html#cb90-8" tabindex="-1"></a>                   <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb90-9"><a href="tidyquant.html#cb90-9" tabindex="-1"></a>                   <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;MA and V: Stock Prices&quot;</span>) <span class="sc">+</span></span>
<span id="cb90-10"><a href="tidyquant.html#cb90-10" tabindex="-1"></a>                   <span class="fu">theme_tq</span>() <span class="sc">+</span> </span>
<span id="cb90-11"><a href="tidyquant.html#cb90-11" tabindex="-1"></a>                   <span class="fu">scale_color_tq</span>()</span></code></pre></div>
<p><img src="Libro_TidyQualityTools_files/figure-html/unnamed-chunk-76-1.png" width="672" /></p>
</div>
<div id="ejemplo-7-utilizar-return.clean-y-return.excess-para-limpiar-y-calcular-el-exceso-de-rendimiento" class="section level3 hasAnchor" number="4.2.7">
<h3><span class="header-section-number">4.2.7</span> Ejemplo 7: utilizar return.clean y return.excess para limpiar y calcular el exceso de rendimiento<a href="tidyquant.html#ejemplo-7-utilizar-return.clean-y-return.excess-para-limpiar-y-calcular-el-exceso-de-rendimiento" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>En este ejemplo primero se calcula los rendimientos diarios utilizando <code>periodReturn</code>, luego se utiliza <code>Return.clean</code> para limpiar los valores atípico de los datos devueltos, en el que el parámetro <code>alpha</code> es el porcentaje de datos atípicos se va a limpiar. Por último, los rendimientos excedentes se calculan con la función <code>Return.excess</code> con el parámetro <code>Rf</code> que representa la tasa libre de riesgo.</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="tidyquant.html#cb91-1" tabindex="-1"></a>FANG <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(symbol) <span class="sc">%&gt;%</span> <span class="fu">tq_transmute</span>(adjusted, periodReturn, <span class="at">period =</span> <span class="st">&quot;daily&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb91-2"><a href="tidyquant.html#cb91-2" tabindex="-1"></a>                              <span class="fu">tq_transmute</span>(daily.returns, Return.clean, <span class="at">alpha =</span> <span class="fl">0.05</span>) <span class="sc">%&gt;%</span></span>
<span id="cb91-3"><a href="tidyquant.html#cb91-3" tabindex="-1"></a>                              <span class="fu">tq_transmute</span>(daily.returns, Return.excess, <span class="at">Rf =</span> <span class="fl">0.03</span> <span class="sc">/</span> <span class="dv">252</span>)</span></code></pre></div>
<pre><code>## # A tibble: 4,032 × 3
## # Groups:   symbol [4]
##    symbol date       `daily.returns &gt; Rf`
##    &lt;chr&gt;  &lt;date&gt;                    &lt;dbl&gt;
##  1 FB     2013-01-02            -0.000119
##  2 FB     2013-01-03            -0.00833 
##  3 FB     2013-01-04             0.0355  
##  4 FB     2013-01-07             0.0228  
##  5 FB     2013-01-08            -0.0124  
##  6 FB     2013-01-09             0.0525  
##  7 FB     2013-01-10             0.0231  
##  8 FB     2013-01-11             0.0133  
##  9 FB     2013-01-14            -0.0244  
## 10 FB     2013-01-15            -0.0276  
## # ℹ 4,022 more rows</code></pre>

</div>
</div>
</div>
            </section>

<<<<<<< HEAD
          </div>
        </div>
      </div>
<a href="r6.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="qualitytools.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
=======
      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Integración del Paquete QualityTools con Tidyverse</strong>" was written by Miguel Flores, Andrea Barahona, Fabián Encarnación, Dario Quishpe. It was last built on 2024-04-23.</p>
>>>>>>> a8b725b107cd3ade9afd4976ed6558cfc0d3c521
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/Libro_TidyQualityTools/edit/master/03-Tidyquant.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["Libro_TidyQualityTools.pdf", "Libro_TidyQualityTools.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
